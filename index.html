<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Carnicer√≠a Pro - DIAN</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f9fafb; }
        
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease-out;
            max-width: 400px;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .notification.info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
        }
        
        .scroll-smooth { scroll-behavior: smooth; }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            gap: 8px;
            height: 200px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(to top, #dc2626, #ef4444);
            border-radius: 4px 4px 0 0;
            position: relative;
            transition: all 0.3s;
        }
        
        .bar:hover {
            opacity: 0.8;
            transform: translateY(-5px);
        }
        
        .bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 11px;
            font-weight: 600;
        }
        
        .bar-value {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
            color: #991b1b;
        }

        /* Login styles */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
            max-width: 450px;
            width: 100%;
        }

        /* Balanza indicator */
        .balanza-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            font-weight: 600;
            z-index: 999;
        }

        .balanza-indicator.disconnected {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // ==================== CONFIGURACI√ìN DE FIREBASE ====================
        // ‚úÖ FIREBASE CONFIGURADO Y LISTO
        // Tu proyecto: mi-carniceria-4a6b5
        // Sincronizaci√≥n en la nube ACTIVA
        
        const firebaseConfig = {
            apiKey: "AIzaSyAzUkfn8wrAYscr1EI6H7wONMMK0qc14ZA",
            authDomain: "mi-carniceria-4a6b5.firebaseapp.com",
            projectId: "mi-carniceria-4a6b5",
            storageBucket: "mi-carniceria-4a6b5.firebasestorage.app",
            messagingSenderId: "115096293476",
            appId: "1:115096293476:web:6f7d90260feaf035a84f71"
        };

        // Inicializar Firebase
        let db = null;
        let firebaseEnabled = false;

        try {
            // Verificar si la configuraci√≥n est√° completa
            if (firebaseConfig.apiKey !== "TU_API_KEY_AQUI") {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                firebaseEnabled = true;
                console.log('üî• Firebase conectado - Sincronizaci√≥n en la nube ACTIVA');
            } else {
                console.log('‚ö†Ô∏è Firebase no configurado - Usando solo localStorage (sin sincronizaci√≥n entre dispositivos)');
                console.log('üìñ Para activar sincronizaci√≥n, configura Firebase en el c√≥digo');
            }
        } catch (error) {
            console.error('‚ùå Error al inicializar Firebase:', error);
            console.log('‚ö†Ô∏è Continuando con localStorage solamente');
        }

        // ==================== GESTOR DE ALMACENAMIENTO CON SINCRONIZACI√ìN ====================
        const StorageManager = {
            // ID √∫nico de la tienda (puedes cambiarlo por el NIT o nombre de tu negocio)
            storeId: 'carniceria-principal',
            
            save: async (key, data) => {
                try {
                    // Guardar en localStorage primero (para acceso r√°pido)
                    localStorage.setItem(key, JSON.stringify(data));
                    console.log(`‚úÖ Guardado localmente: ${key}`);
                    
                    // Si Firebase est√° habilitado, sincronizar en la nube
                    if (firebaseEnabled && db) {
                        await db.collection(StorageManager.storeId).doc(key).set({
                            data: data,
                            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        console.log(`‚òÅÔ∏è Sincronizado en la nube: ${key}`);
                    }
                    
                    return true;
                } catch (error) {
                    console.error(`‚ùå Error al guardar ${key}:`, error);
                    return false;
                }
            },
            
            load: async (key, defaultValue = null) => {
                try {
                    // Si Firebase est√° habilitado, intentar cargar desde la nube primero
                    if (firebaseEnabled && db) {
                        try {
                            const doc = await db.collection(StorageManager.storeId).doc(key).get();
                            if (doc.exists) {
                                const cloudData = doc.data().data;
                                // Actualizar localStorage con datos de la nube
                                localStorage.setItem(key, JSON.stringify(cloudData));
                                console.log(`‚òÅÔ∏è Cargado desde la nube: ${key}`);
                                return cloudData;
                            }
                        } catch (error) {
                            console.log(`‚ö†Ô∏è No se pudo cargar desde la nube, usando localStorage`);
                        }
                    }
                    
                    // Cargar desde localStorage
                    const item = localStorage.getItem(key);
                    if (item) {
                        console.log(`üì• Cargado desde localStorage: ${key}`);
                        return JSON.parse(item);
                    }
                    return defaultValue;
                } catch (error) {
                    console.error(`‚ùå Error al cargar ${key}:`, error);
                    return defaultValue;
                }
            },
            
            remove: async (key) => {
                try {
                    // Eliminar de localStorage
                    localStorage.removeItem(key);
                    
                    // Eliminar de Firebase si est√° habilitado
                    if (firebaseEnabled && db) {
                        await db.collection(StorageManager.storeId).doc(key).delete();
                        console.log(`‚òÅÔ∏è Eliminado de la nube: ${key}`);
                    }
                    
                    console.log(`üóëÔ∏è Eliminado: ${key}`);
                    return true;
                } catch (error) {
                    console.error(`‚ùå Error al eliminar ${key}:`, error);
                    return false;
                }
            },
            
            clear: async () => {
                try {
                    // Limpiar localStorage
                    localStorage.clear();
                    
                    // Limpiar Firebase si est√° habilitado
                    if (firebaseEnabled && db) {
                        const snapshot = await db.collection(StorageManager.storeId).get();
                        const batch = db.batch();
                        snapshot.docs.forEach(doc => batch.delete(doc.ref));
                        await batch.commit();
                        console.log('‚òÅÔ∏è Nube limpiada completamente');
                    }
                    
                    console.log('üóëÔ∏è Almacenamiento limpiado completamente');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error al limpiar almacenamiento:', error);
                    return false;
                }
            },
            
            exportAll: () => {
                const data = {
                    productos: JSON.parse(localStorage.getItem('productos') || '[]'),
                    ventas: JSON.parse(localStorage.getItem('ventas') || '[]'),
                    clientes: JSON.parse(localStorage.getItem('clientes') || '[]'),
                    usuarios: JSON.parse(localStorage.getItem('usuarios') || '[]'),
                    dianConfig: JSON.parse(localStorage.getItem('dianConfig') || '{}'),
                    balanzaConfig: JSON.parse(localStorage.getItem('balanzaConfig') || '{}'),
                    exportDate: new Date().toISOString()
                };
                return data;
            },
            
            importAll: async (data) => {
                try {
                    if (data.productos) await StorageManager.save('productos', data.productos);
                    if (data.ventas) await StorageManager.save('ventas', data.ventas);
                    if (data.clientes) await StorageManager.save('clientes', data.clientes);
                    if (data.usuarios) await StorageManager.save('usuarios', data.usuarios);
                    if (data.dianConfig) await StorageManager.save('dianConfig', data.dianConfig);
                    if (data.balanzaConfig) await StorageManager.save('balanzaConfig', data.balanzaConfig);
                    return true;
                } catch (error) {
                    console.error('‚ùå Error al importar datos:', error);
                    return false;
                }
            },

            // Funci√≥n para sincronizar datos desde la nube (√∫til al cargar la app)
            syncFromCloud: async () => {
                if (!firebaseEnabled || !db) {
                    console.log('‚ö†Ô∏è Firebase no est√° habilitado, no se puede sincronizar');
                    return false;
                }

                try {
                    console.log('üîÑ Sincronizando datos desde la nube...');
                    const snapshot = await db.collection(StorageManager.storeId).get();
                    
                    snapshot.forEach(doc => {
                        const key = doc.id;
                        const data = doc.data().data;
                        localStorage.setItem(key, JSON.stringify(data));
                    });
                    
                    console.log('‚úÖ Sincronizaci√≥n completada');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error al sincronizar desde la nube:', error);
                    return false;
                }
            },

            // Verificar el estado de Firebase
            getStatus: () => {
                return {
                    firebaseEnabled: firebaseEnabled,
                    storeId: StorageManager.storeId,
                    message: firebaseEnabled 
                        ? 'üî• Sincronizaci√≥n en la nube ACTIVA - Tus datos se guardan autom√°ticamente y est√°n disponibles en todos tus dispositivos' 
                        : '‚ö†Ô∏è Solo localStorage - Configura Firebase para sincronizar entre dispositivos'
                };
            }
        };

        // ==================== SIMULADOR DE BALANZA ====================
        const BalanzaSimulator = {
            connected: false,
            currentWeight: 0,
            listeners: [],

            connect: (config) => {
                console.log('üîå Conectando a balanza...', config);
                BalanzaSimulator.connected = true;
                BalanzaSimulator.startSimulation();
                return true;
            },

            disconnect: () => {
                console.log('üîå Desconectando balanza...');
                BalanzaSimulator.connected = false;
                BalanzaSimulator.currentWeight = 0;
                BalanzaSimulator.notifyListeners();
            },

            startSimulation: () => {
                // Simular cambios de peso aleatorios cada 2 segundos
                setInterval(() => {
                    if (BalanzaSimulator.connected) {
                        // Peso aleatorio entre 0 y 5 kg
                        const randomWeight = (Math.random() * 5).toFixed(2);
                        BalanzaSimulator.currentWeight = parseFloat(randomWeight);
                        BalanzaSimulator.notifyListeners();
                    }
                }, 2000);
            },

            getWeight: () => {
                return BalanzaSimulator.currentWeight;
            },

            addListener: (callback) => {
                BalanzaSimulator.listeners.push(callback);
            },

            removeListener: (callback) => {
                BalanzaSimulator.listeners = BalanzaSimulator.listeners.filter(l => l !== callback);
            },

            notifyListeners: () => {
                BalanzaSimulator.listeners.forEach(callback => {
                    callback(BalanzaSimulator.currentWeight);
                });
            }
        };

        // ==================== COMPONENTE DE ICONOS ====================
        function Icon({ name, className = "w-6 h-6", ...props }) {
            const icons = {
                ShoppingCart: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                ),
                Package: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                ),
                Users: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                ),
                Settings: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                ),
                Receipt: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 14l6-6m-5.5.5h.01m4.99 5h.01M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16l3.5-2 3.5 2 3.5-2 3.5 2zM10 8.5a.5.5 0 11-1 0 .5.5 0 011 0zm5 5a.5.5 0 11-1 0 .5.5 0 011 0z" />
                    </svg>
                ),
                ChartBar: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                ),
                TrendingUp: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                ),
                DollarSign: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                Plus: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                    </svg>
                ),
                Edit: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                    </svg>
                ),
                Trash: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                ),
                X: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                ),
                Check: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                    </svg>
                ),
                Download: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                ),
                Upload: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                    </svg>
                ),
                Eye: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                ),
                Calendar: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                ),
                CreditCard: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                    </svg>
                ),
                Clock: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                ),
                Filter: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                    </svg>
                ),
                Search: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                ),
                Lock: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                ),
                Logout: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                ),
                User: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                ),
                Barcode: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                        <rect x="2" y="6" width="2" height="12" fill="currentColor" />
                        <rect x="6" y="6" width="1" height="12" fill="currentColor" />
                        <rect x="9" y="6" width="2" height="12" fill="currentColor" />
                        <rect x="13" y="6" width="1" height="12" fill="currentColor" />
                        <rect x="16" y="6" width="2" height="12" fill="currentColor" />
                        <rect x="20" y="6" width="2" height="12" fill="currentColor" />
                    </svg>
                ),
                Scale: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                    </svg>
                ),
                Shield: () => (
                    <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" {...props}>
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                )
            };
            
            const IconComponent = icons[name];
            return IconComponent ? <IconComponent /> : null;
        }

        // ==================== COMPONENTE DE NOTIFICACIONES ====================
        function Notification({ message, type, onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`notification ${type}`}>
                    {type === 'success' && <Icon name="Check" className="w-6 h-6" />}
                    {type === 'error' && <Icon name="X" className="w-6 h-6" />}
                    {type === 'info' && <span className="spinner"></span>}
                    <span>{message}</span>
                </div>
            );
        }

        // ==================== PANTALLA DE LOGIN ====================
        function LoginScreen({ onLogin, showNotification }) {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');

            // Inicializar usuarios por defecto SIEMPRE
            useEffect(() => {
                const usuariosDefault = [
                    {
                        id: 'admin-1',
                        username: 'admin',
                        password: 'admin123',
                        nombre: 'Administrador',
                        rol: 'admin',
                        fechaCreacion: new Date().toISOString()
                    },
                    {
                        id: 'vendedor-1',
                        username: 'vendedor',
                        password: 'vendedor123',
                        nombre: 'Vendedor',
                        rol: 'vendedor',
                        fechaCreacion: new Date().toISOString()
                    }
                ];

                // Cargar usuarios existentes
                let usuarios = StorageManager.load('usuarios', []);
                
                // Si no hay usuarios O no existen los usuarios por defecto, crearlos
                if (usuarios.length === 0) {
                    StorageManager.save('usuarios', usuariosDefault);
                } else {
                    // Verificar que existan los usuarios por defecto
                    const tieneAdmin = usuarios.some(u => u.username === 'admin');
                    const tieneVendedor = usuarios.some(u => u.username === 'vendedor');
                    
                    if (!tieneAdmin || !tieneVendedor) {
                        // Agregar los que faltan
                        if (!tieneAdmin) {
                            usuarios.push(usuariosDefault[0]);
                        }
                        if (!tieneVendedor) {
                            usuarios.push(usuariosDefault[1]);
                        }
                        StorageManager.save('usuarios', usuarios);
                    }
                }
            }, []);

            const handleSubmit = (e) => {
                e.preventDefault();
                
                // Cargar usuarios
                let usuarios = StorageManager.load('usuarios', []);
                
                console.log('Intentando login con:', username);
                console.log('Usuarios disponibles:', usuarios);

                // Verificar credenciales
                const usuario = usuarios.find(u => 
                    u.username.trim().toLowerCase() === username.trim().toLowerCase() && 
                    u.password === password
                );
                
                if (usuario) {
                    console.log('Login exitoso:', usuario);
                    onLogin(usuario);
                    showNotification(`¬°Bienvenido ${usuario.nombre}!`, 'success');
                } else {
                    console.log('Login fallido');
                    showNotification('Usuario o contrase√±a incorrectos', 'error');
                }
            };

            const loginRapido = (user, pass) => {
                setUsername(user);
                setPassword(pass);
                setTimeout(() => {
                    const event = new Event('submit', { bubbles: true, cancelable: true });
                    document.querySelector('form').dispatchEvent(event);
                }, 100);
            };

            return (
                <div className="login-container">
                    <div className="login-box">
                        <div className="text-center mb-8">
                            <div className="bg-red-600 p-4 rounded-full w-20 h-20 mx-auto mb-4 flex items-center justify-center">
                                <Icon name="ShoppingCart" className="w-10 h-10 text-white" />
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800">Sistema de Carnicer√≠a</h1>
                            <p className="text-gray-600 mt-2">Inicia sesi√≥n para continuar</p>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Usuario
                                </label>
                                <div className="relative">
                                    <Icon name="User" className="w-5 h-5 absolute left-3 top-3.5 text-gray-400" />
                                    <input
                                        type="text"
                                        value={username}
                                        onChange={(e) => setUsername(e.target.value)}
                                        className="w-full pl-10 pr-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                        placeholder="admin"
                                        required
                                        autoComplete="username"
                                    />
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Contrase√±a
                                </label>
                                <div className="relative">
                                    <Icon name="Lock" className="w-5 h-5 absolute left-3 top-3.5 text-gray-400" />
                                    <input
                                        type="password"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="w-full pl-10 pr-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        required
                                        autoComplete="current-password"
                                    />
                                </div>
                            </div>

                            <button
                                type="submit"
                                className="w-full bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-bold text-lg shadow-lg transition-all"
                            >
                                Iniciar Sesi√≥n
                            </button>
                            
                            <div className="grid grid-cols-2 gap-3">
                                <button
                                    type="button"
                                    onClick={() => {
                                        setUsername('admin');
                                        setPassword('admin123');
                                    }}
                                    className="bg-purple-100 text-purple-700 py-2 px-4 rounded-lg hover:bg-purple-200 font-semibold text-sm transition-all border-2 border-purple-300"
                                >
                                    üë®‚Äçüíº Usar Admin
                                </button>
                                <button
                                    type="button"
                                    onClick={() => {
                                        setUsername('vendedor');
                                        setPassword('vendedor123');
                                    }}
                                    className="bg-blue-100 text-blue-700 py-2 px-4 rounded-lg hover:bg-blue-200 font-semibold text-sm transition-all border-2 border-blue-300"
                                >
                                    üë§ Usar Vendedor
                                </button>
                            </div>
                            
                            <button
                                type="button"
                                onClick={() => {
                                    if (confirm('¬øRestablecer usuarios por defecto? Esto no afectar√° tus productos ni ventas.')) {
                                        const usuariosDefault = [
                                            {
                                                id: 'admin-1',
                                                username: 'admin',
                                                password: 'admin123',
                                                nombre: 'Administrador',
                                                rol: 'admin',
                                                fechaCreacion: new Date().toISOString()
                                            },
                                            {
                                                id: 'vendedor-1',
                                                username: 'vendedor',
                                                password: 'vendedor123',
                                                nombre: 'Vendedor',
                                                rol: 'vendedor',
                                                fechaCreacion: new Date().toISOString()
                                            }
                                        ];
                                        StorageManager.save('usuarios', usuariosDefault);
                                        showNotification('Usuarios restablecidos correctamente', 'success');
                                    }
                                }}
                                className="w-full bg-yellow-100 text-yellow-700 py-2 px-4 rounded-lg hover:bg-yellow-200 font-semibold text-sm transition-all border-2 border-yellow-300"
                            >
                                üîß Restablecer Usuarios
                            </button>
                        </form>

                        <div className="mt-8 p-5 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg border-2 border-blue-200">
                            <p className="text-sm font-bold mb-3 text-blue-900 flex items-center gap-2">
                                <Icon name="User" className="w-5 h-5" />
                                Credenciales de Acceso:
                            </p>
                            <div className="space-y-3">
                                <div className="bg-white p-3 rounded-lg border border-blue-200">
                                    <p className="font-semibold text-gray-800">üë®‚Äçüíº Administrador</p>
                                    <p className="text-sm text-gray-600 mt-1">
                                        <strong>Usuario:</strong> <code className="bg-gray-100 px-2 py-1 rounded">admin</code><br/>
                                        <strong>Contrase√±a:</strong> <code className="bg-gray-100 px-2 py-1 rounded">admin123</code>
                                    </p>
                                    <p className="text-xs text-blue-600 mt-2">‚úì Acceso completo al sistema</p>
                                </div>
                                <div className="bg-white p-3 rounded-lg border border-blue-200">
                                    <p className="font-semibold text-gray-800">üë§ Vendedor</p>
                                    <p className="text-sm text-gray-600 mt-1">
                                        <strong>Usuario:</strong> <code className="bg-gray-100 px-2 py-1 rounded">vendedor</code><br/>
                                        <strong>Contrase√±a:</strong> <code className="bg-gray-100 px-2 py-1 rounded">vendedor123</code>
                                    </p>
                                    <p className="text-xs text-blue-600 mt-2">‚úì Solo punto de venta</p>
                                </div>
                            </div>
                            <p className="text-xs text-blue-700 mt-3 text-center font-semibold">
                                ‚ö†Ô∏è Copia y pega las credenciales o escr√≠belas exactamente
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        // ==================== INDICADOR DE SINCRONIZACI√ìN FIREBASE ====================
        function FirebaseIndicator() {
            const status = StorageManager.getStatus();
            const [syncing, setSyncing] = useState(false);

            const handleSync = async () => {
                if (!status.firebaseEnabled) {
                    alert('Firebase no est√° configurado. Ve a la secci√≥n de configuraci√≥n para m√°s informaci√≥n.');
                    return;
                }
                
                setSyncing(true);
                const success = await StorageManager.syncFromCloud();
                setSyncing(false);
                
                if (success) {
                    alert('‚úÖ Datos sincronizados correctamente desde la nube');
                    window.location.reload();
                } else {
                    alert('‚ùå Error al sincronizar datos');
                }
            };

            return (
                <div 
                    className={`fixed bottom-20 left-20 p-3 rounded-xl shadow-lg z-999 cursor-pointer transition-all hover:shadow-2xl ${
                        status.firebaseEnabled 
                            ? 'bg-gradient-to-r from-green-500 to-green-600' 
                            : 'bg-gradient-to-r from-yellow-500 to-yellow-600'
                    }`}
                    onClick={handleSync}
                    title={status.message}
                >
                    <div className="flex items-center gap-3">
                        {status.firebaseEnabled ? (
                            <>
                                <Icon name="Cloud" className="w-6 h-6 text-white" />
                                <div className="text-white">
                                    <p className="text-xs font-semibold opacity-90">Sincronizaci√≥n</p>
                                    <p className="text-sm font-bold">
                                        {syncing ? 'Sincronizando...' : 'Activa ‚òÅÔ∏è'}
                                    </p>
                                </div>
                                {!syncing && <div className="w-2 h-2 bg-white rounded-full pulse"></div>}
                            </>
                        ) : (
                            <>
                                <Icon name="AlertCircle" className="w-6 h-6 text-white" />
                                <div className="text-white">
                                    <p className="text-xs font-semibold opacity-90">Solo Local</p>
                                    <p className="text-sm font-bold">Sin Nube</p>
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        }

        // ==================== INDICADOR DE BALANZA ====================
        function BalanzaIndicator({ balanzaConfig, currentWeight }) {
            const [connected, setConnected] = useState(false);

            useEffect(() => {
                if (balanzaConfig.habilitada) {
                    const success = BalanzaSimulator.connect(balanzaConfig);
                    setConnected(success);
                } else {
                    BalanzaSimulator.disconnect();
                    setConnected(false);
                }
            }, [balanzaConfig]);

            if (!balanzaConfig.habilitada) return null;

            return (
                <div className={`balanza-indicator ${connected ? '' : 'disconnected'}`}>
                    <div className="flex items-center gap-3">
                        <Icon name="Scale" className="w-6 h-6" />
                        <div>
                            <p className="text-xs opacity-90">Balanza</p>
                            <p className="text-lg font-bold">{currentWeight} Kg</p>
                        </div>
                        {connected && <div className="w-2 h-2 bg-white rounded-full pulse"></div>}
                    </div>
                </div>
            );
        }

        // ==================== APLICACI√ìN PRINCIPAL ====================
        function App() {
            const [currentUser, setCurrentUser] = useState(null);
            const [activeTab, setActiveTab] = useState('ventas');
            const [productos, setProductos] = useState([]);
            const [ventas, setVentas] = useState([]);
            const [clientes, setClientes] = useState([]);
            const [usuarios, setUsuarios] = useState([]);
            const [cart, setCart] = useState([]);
            const [notification, setNotification] = useState(null);
            const [currentWeight, setCurrentWeight] = useState(0);
            const [dianConfig, setDianConfig] = useState({
                // Datos empresa
                nit: '',
                razonSocial: '',
                nombreComercial: '',
                direccion: '',
                ciudad: '',
                departamento: '',
                telefono: '',
                email: '',
                actividadEconomica: '',
                // Responsabilidades fiscales
                responsabilidadFiscal: 'O-13', // Gran Contribuyente, Autoretenedor, etc
                regimenFiscal: 'Com√∫n',
                // Resoluci√≥n DIAN
                resolucionFacturacion: '',
                prefijoFactura: 'FV',
                rangoInicial: '',
                rangoFinal: '',
                fechaResolucion: '',
                consecutivoActual: 1,
                // Facturaci√≥n electr√≥nica
                claveTecnica: '',
                testSetId: '',
                softwareId: '',
                softwarePin: '',
                ambiente: 'habilitacion',
                // Representante legal
                representanteLegal: '',
                tipoDocRepresentante: 'CC',
                cedulaRepresentante: '',
                // Contador
                contador: '',
                tarjetaContador: '',
                // Configuraci√≥n
                mostrarQR: true,
                notificarDIAN: false
            });
            const [balanzaConfig, setBalanzaConfig] = useState({
                habilitada: false,
                puerto: 'COM1',
                baudRate: 9600,
                marca: 'TORREY',
                modelo: 'EQM',
                autoCaptura: true
            });

            // Cargar datos al iniciar
            useEffect(() => {
                console.log('üöÄ Iniciando aplicaci√≥n...');
                
                // Cargar productos
                const loadedProductos = StorageManager.load('productos', []);
                if (loadedProductos.length > 0) {
                    setProductos(loadedProductos);
                } else {
                    // Productos de ejemplo con c√≥digo de barras
                    const ejemploProductos = [
                        {
                            id: Date.now() + '-1',
                            nombre: 'Carne de Res (Kg)',
                            codigoBarras: '7501234567890',
                            precioCompra: 15000,
                            precioVenta: 22000,
                            stock: 50,
                            categoria: 'Res',
                            fechaCreacion: new Date().toISOString()
                        },
                        {
                            id: Date.now() + '-2',
                            nombre: 'Pollo Entero (Kg)',
                            codigoBarras: '7501234567891',
                            precioCompra: 8000,
                            precioVenta: 12000,
                            stock: 30,
                            categoria: 'Pollo',
                            fechaCreacion: new Date().toISOString()
                        },
                        {
                            id: Date.now() + '-3',
                            nombre: 'Cerdo (Kg)',
                            codigoBarras: '7501234567892',
                            precioCompra: 12000,
                            precioVenta: 18000,
                            stock: 25,
                            categoria: 'Cerdo',
                            fechaCreacion: new Date().toISOString()
                        }
                    ];
                    setProductos(ejemploProductos);
                    StorageManager.save('productos', ejemploProductos);
                }
                
                // Cargar ventas
                const loadedVentas = StorageManager.load('ventas', []);
                setVentas(loadedVentas);
                
                // Cargar clientes
                const loadedClientes = StorageManager.load('clientes', []);
                if (loadedClientes.length > 0) {
                    setClientes(loadedClientes);
                } else {
                    const clienteGenerico = {
                        id: 'generic-client',
                        nombre: 'Cliente General',
                        tipoDoc: 'CC',
                        numeroDoc: '0000000000',
                        telefono: '',
                        email: '',
                        direccion: '',
                        fechaCreacion: new Date().toISOString()
                    };
                    setClientes([clienteGenerico]);
                    StorageManager.save('clientes', [clienteGenerico]);
                }
                
                // Cargar usuarios
                const loadedUsuarios = StorageManager.load('usuarios', []);
                setUsuarios(loadedUsuarios);
                
                // Cargar configuraci√≥n DIAN
                const loadedConfig = StorageManager.load('dianConfig', null);
                if (loadedConfig) {
                    setDianConfig(loadedConfig);
                }

                // Cargar configuraci√≥n de balanza
                const loadedBalanzaConfig = StorageManager.load('balanzaConfig', null);
                if (loadedBalanzaConfig) {
                    setBalanzaConfig(loadedBalanzaConfig);
                }
                
                console.log('‚úÖ Datos cargados exitosamente');
            }, []);

            // Listener de balanza
            useEffect(() => {
                const handleWeightChange = (weight) => {
                    setCurrentWeight(weight);
                };

                BalanzaSimulator.addListener(handleWeightChange);

                return () => {
                    BalanzaSimulator.removeListener(handleWeightChange);
                };
            }, []);

            // Guardar autom√°ticamente
            useEffect(() => {
                if (productos.length > 0) {
                    StorageManager.save('productos', productos);
                }
            }, [productos]);

            useEffect(() => {
                if (ventas.length > 0) {
                    StorageManager.save('ventas', ventas);
                }
            }, [ventas]);

            useEffect(() => {
                if (clientes.length > 0) {
                    StorageManager.save('clientes', clientes);
                }
            }, [clientes]);

            useEffect(() => {
                if (usuarios.length > 0) {
                    StorageManager.save('usuarios', usuarios);
                }
            }, [usuarios]);

            useEffect(() => {
                StorageManager.save('dianConfig', dianConfig);
            }, [dianConfig]);

            useEffect(() => {
                StorageManager.save('balanzaConfig', balanzaConfig);
            }, [balanzaConfig]);

            const showNotification = (message, type = 'info') => {
                setNotification({ message, type });
            };

            const handleLogin = (usuario) => {
                setCurrentUser(usuario);
                StorageManager.save('currentUser', usuario);
            };

            const handleLogout = () => {
                if (confirm('¬øEst√°s seguro de cerrar sesi√≥n?')) {
                    setCurrentUser(null);
                    StorageManager.remove('currentUser');
                    setActiveTab('ventas');
                    setCart([]);
                    showNotification('Sesi√≥n cerrada exitosamente', 'info');
                }
            };

            // No cargar sesi√≥n autom√°ticamente para evitar problemas
            // El usuario debe iniciar sesi√≥n cada vez

            // Si no hay usuario logueado, mostrar pantalla de login
            if (!currentUser) {
                return (
                    <>
                        {notification && (
                            <Notification 
                                message={notification.message}
                                type={notification.type}
                                onClose={() => setNotification(null)}
                            />
                        )}
                        <LoginScreen onLogin={handleLogin} showNotification={showNotification} />
                    </>
                );
            }

            // Determinar tabs disponibles seg√∫n rol
            const availableTabs = currentUser.rol === 'admin' 
                ? [
                    { id: 'ventas', icon: 'ShoppingCart', label: 'Punto de Venta' },
                    { id: 'historial', icon: 'Receipt', label: 'Historial' },
                    { id: 'reportes', icon: 'ChartBar', label: 'Reportes' },
                    { id: 'productos', icon: 'Package', label: 'Productos' },
                    { id: 'clientes', icon: 'Users', label: 'Clientes' },
                    { id: 'usuarios', icon: 'User', label: 'Usuarios' },
                    { id: 'configuracion', icon: 'Settings', label: 'Configuraci√≥n' }
                ]
                : [
                    { id: 'ventas', icon: 'ShoppingCart', label: 'Punto de Venta' }
                ];

            const renderContent = () => {
                switch (activeTab) {
                    case 'ventas':
                        return <VentasTab 
                            productos={productos}
                            cart={cart}
                            setCart={setCart}
                            clientes={clientes}
                            ventas={ventas}
                            setVentas={setVentas}
                            setProductos={setProductos}
                            dianConfig={dianConfig}
                            balanzaConfig={balanzaConfig}
                            currentWeight={currentWeight}
                            currentUser={currentUser}
                            showNotification={showNotification}
                        />;
                    case 'productos':
                        return <ProductosTab 
                            productos={productos}
                            setProductos={setProductos}
                            showNotification={showNotification}
                        />;
                    case 'historial':
                        return <HistorialTab 
                            ventas={ventas}
                            productos={productos}
                            clientes={clientes}
                            showNotification={showNotification}
                        />;
                    case 'reportes':
                        return <ReportesTab 
                            ventas={ventas}
                            productos={productos}
                            showNotification={showNotification}
                        />;
                    case 'clientes':
                        return <ClientesTab 
                            clientes={clientes}
                            setClientes={setClientes}
                            showNotification={showNotification}
                        />;
                    case 'usuarios':
                        return <UsuariosTab 
                            usuarios={usuarios}
                            setUsuarios={setUsuarios}
                            currentUser={currentUser}
                            showNotification={showNotification}
                        />;
                    case 'configuracion':
                        return <ConfiguracionTab 
                            dianConfig={dianConfig}
                            setDianConfig={setDianConfig}
                            balanzaConfig={balanzaConfig}
                            setBalanzaConfig={setBalanzaConfig}
                            productos={productos}
                            ventas={ventas}
                            clientes={clientes}
                            currentWeight={currentWeight}
                            showNotification={showNotification}
                        />;
                    default:
                        return null;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                    {notification && (
                        <Notification 
                            message={notification.message}
                            type={notification.type}
                            onClose={() => setNotification(null)}
                        />
                    )}

                    {/* Indicador de balanza */}
                    <BalanzaIndicator balanzaConfig={balanzaConfig} currentWeight={currentWeight} />

                    {/* Indicador de sincronizaci√≥n Firebase */}
                    <FirebaseIndicator />

                    {/* Header */}
                    <header className="bg-gradient-to-r from-red-600 to-red-700 text-white shadow-xl">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <div className="bg-white p-3 rounded-xl shadow-lg">
                                        <Icon name="ShoppingCart" className="w-8 h-8 text-red-600" />
                                    </div>
                                    <div>
                                        <h1 className="text-3xl font-bold">Sistema de Carnicer√≠a Pro</h1>
                                        <p className="text-red-100 text-sm mt-1">Facturaci√≥n electr√≥nica DIAN</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="text-right">
                                        <p className="text-sm font-semibold">{currentUser.nombre}</p>
                                        <p className="text-xs text-red-100 capitalize">{currentUser.rol}</p>
                                    </div>
                                    <button
                                        onClick={handleLogout}
                                        className="bg-red-800 hover:bg-red-900 p-3 rounded-lg transition-all"
                                        title="Cerrar Sesi√≥n"
                                    >
                                        <Icon name="Logout" className="w-5 h-5" />
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Navegaci√≥n */}
                    <nav className="bg-white shadow-md sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div className="flex space-x-1 overflow-x-auto">
                                {availableTabs.map(tab => (
                                    <button
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-6 py-4 font-semibold transition-all whitespace-nowrap ${
                                            activeTab === tab.id
                                                ? 'text-red-600 border-b-4 border-red-600 bg-red-50'
                                                : 'text-gray-600 hover:text-red-600 hover:bg-gray-50'
                                        }`}
                                    >
                                        <Icon name={tab.icon} className="w-5 h-5" />
                                        <span>{tab.label}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Contenido */}
                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                        {renderContent()}
                    </main>

                    {/* Footer */}
                    <footer className="bg-white border-t mt-12 py-6">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-600">
                            <p className="font-semibold">Sistema de Carnicer√≠a Pro v3.0</p>
                            <p className="text-sm mt-2">100% aut√≥nomo | Facturaci√≥n electr√≥nica DIAN | Multi-usuario</p>
                        </div>
                    </footer>
                </div>
            );
        }

        // ==================== TAB DE VENTAS ====================
        function VentasTab({ productos, cart, setCart, clientes, ventas, setVentas, setProductos, dianConfig, balanzaConfig, currentWeight, currentUser, showNotification }) {
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [weight, setWeight] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [showInvoiceModal, setShowInvoiceModal] = useState(false);
            const [saleForInvoice, setSaleForInvoice] = useState(null);
            const [usarPesoAutomatico, setUsarPesoAutomatico] = useState(true);
            const barcodeInputRef = useRef(null);

            // Filtrar productos por b√∫squeda o c√≥digo de barras
            const filteredProductos = productos.filter(p => 
                p.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.categoria.toLowerCase().includes(searchTerm.toLowerCase()) ||
                (p.codigoBarras && p.codigoBarras.includes(searchTerm))
            );

            // Buscar producto por c√≥digo de barras
            useEffect(() => {
                if (searchTerm.length >= 13) {
                    const producto = productos.find(p => p.codigoBarras === searchTerm);
                    if (producto) {
                        setSelectedProduct(producto);
                        setSearchTerm('');
                        showNotification(`Producto encontrado: ${producto.nombre}`, 'success');
                        setTimeout(() => {
                            const weightInput = document.querySelector('input[type="number"]');
                            if (weightInput) weightInput.focus();
                        }, 100);
                    }
                }
            }, [searchTerm, productos]);

            // Auto-capturar peso de la balanza SOLO si est√° habilitado
            useEffect(() => {
                if (balanzaConfig.habilitada && usarPesoAutomatico && selectedProduct && currentWeight > 0) {
                    setWeight(currentWeight.toString());
                }
            }, [currentWeight, balanzaConfig, selectedProduct, usarPesoAutomatico]);

            const addToCart = () => {
                if (!selectedProduct || !weight || parseFloat(weight) <= 0) {
                    showNotification('Selecciona un producto y cantidad v√°lida', 'error');
                    return;
                }

                const weightNum = parseFloat(weight);
                if (weightNum > selectedProduct.stock) {
                    showNotification(`Stock insuficiente. Disponible: ${selectedProduct.stock} Kg`, 'error');
                    return;
                }

                const newItem = {
                    id: Date.now(),
                    productId: selectedProduct.id,
                    name: selectedProduct.nombre,
                    weight: weightNum,
                    pricePerKg: selectedProduct.precioVenta,
                    precioCompra: selectedProduct.precioCompra,
                    subtotal: weightNum * selectedProduct.precioVenta,
                    utilidad: (selectedProduct.precioVenta - selectedProduct.precioCompra) * weightNum
                };

                setCart([...cart, newItem]);
                setWeight('');
                setSelectedProduct(null);
                showNotification(`${selectedProduct.nombre} agregado al carrito`, 'success');
                
                if (barcodeInputRef.current) {
                    barcodeInputRef.current.focus();
                }
            };

            const removeFromCart = (itemId) => {
                setCart(cart.filter(item => item.id !== itemId));
                showNotification('Producto eliminado del carrito', 'info');
            };

            const cartTotal = cart.reduce((sum, item) => sum + item.subtotal, 0);
            const cartUtilidad = cart.reduce((sum, item) => sum + item.utilidad, 0);

            const processSale = (tipoPago = 'Efectivo') => {
                if (cart.length === 0) {
                    showNotification('El carrito est√° vac√≠o', 'error');
                    return;
                }

                const sale = {
                    id: Date.now().toString(),
                    fecha: new Date().toISOString(),
                    items: [...cart],
                    total: cartTotal,
                    utilidadTotal: cartUtilidad,
                    tipoPago: tipoPago,
                    clienteId: clientes[0]?.id || 'generic-client',
                    clienteNombre: clientes[0]?.nombre || 'Cliente General',
                    vendedor: currentUser.nombre,
                    numeroFactura: `${dianConfig.prefijoFactura}-${dianConfig.consecutivoActual}`
                };

                const updatedProductos = productos.map(p => {
                    const cartItem = cart.find(item => item.productId === p.id);
                    if (cartItem) {
                        return { ...p, stock: p.stock - cartItem.weight };
                    }
                    return p;
                });

                setProductos(updatedProductos);
                setVentas([sale, ...ventas]);
                
                setSaleForInvoice(sale);
                setShowInvoiceModal(true);
                
                showNotification(`¬°Venta procesada! Total: $${cartTotal.toLocaleString('es-CO')}`, 'success');
            };

            return (
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    {/* Panel de productos */}
                    <div className="lg:col-span-2 space-y-6">
                        {/* B√∫squeda con c√≥digo de barras */}
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <div className="flex items-center gap-3 mb-4">
                                <Icon name="Barcode" className="w-6 h-6 text-red-600" />
                                <input
                                    ref={barcodeInputRef}
                                    type="text"
                                    placeholder="Buscar por nombre, categor√≠a o escanear c√≥digo de barras..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="flex-1 px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 text-lg"
                                    autoFocus
                                />
                            </div>
                            
                            {/* Indicador de balanza */}
                            {balanzaConfig.habilitada && (
                                <div className="flex items-center justify-between p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                    <div className="flex items-center gap-3">
                                        <Icon name="Scale" className="w-6 h-6 text-green-600" />
                                        <div>
                                            <p className="font-semibold text-green-700">Balanza conectada</p>
                                            <p className="text-sm text-green-600">Peso actual: <span className="font-bold text-lg">{currentWeight} Kg</span></p>
                                        </div>
                                    </div>
                                    <button
                                        onClick={() => setUsarPesoAutomatico(!usarPesoAutomatico)}
                                        className={`px-4 py-2 rounded-lg font-semibold transition-all ${
                                            usarPesoAutomatico 
                                                ? 'bg-green-600 text-white hover:bg-green-700' 
                                                : 'bg-gray-300 text-gray-700 hover:bg-gray-400'
                                        }`}
                                    >
                                        {usarPesoAutomatico ? 'üîÑ Auto' : '‚úã Manual'}
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* Selecci√≥n de producto */}
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                <Icon name="Package" className="w-6 h-6 text-red-600" />
                                Productos Disponibles
                            </h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 max-h-96 overflow-y-auto">
                                {filteredProductos.map(producto => (
                                    <button
                                        key={producto.id}
                                        onClick={() => setSelectedProduct(producto)}
                                        className={`p-4 border-2 rounded-lg text-left transition-all hover:shadow-md ${
                                            selectedProduct?.id === producto.id 
                                                ? 'border-red-600 bg-red-50 shadow-lg' 
                                                : 'border-gray-200 hover:border-red-300'
                                        }`}
                                    >
                                        <div className="flex justify-between items-start mb-2">
                                            <div>
                                                <h4 className="font-bold text-lg">{producto.nombre}</h4>
                                                {producto.codigoBarras && (
                                                    <p className="text-xs text-gray-500 flex items-center gap-1 mt-1">
                                                        <Icon name="Barcode" className="w-3 h-3" />
                                                        {producto.codigoBarras}
                                                    </p>
                                                )}
                                            </div>
                                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                                producto.stock > 10 ? 'bg-green-100 text-green-800' :
                                                producto.stock > 0 ? 'bg-yellow-100 text-yellow-800' :
                                                'bg-red-100 text-red-800'
                                            }`}>
                                                {producto.stock} Kg
                                            </span>
                                        </div>
                                        <p className="text-sm text-gray-600 mb-2">{producto.categoria}</p>
                                        <div className="flex justify-between items-center">
                                            <span className="text-2xl font-bold text-red-600">
                                                ${producto.precioVenta.toLocaleString('es-CO')}/Kg
                                            </span>
                                            <span className="text-xs text-gray-500">
                                                +${(producto.precioVenta - producto.precioCompra).toLocaleString('es-CO')}
                                            </span>
                                        </div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Agregar al carrito */}
                        {selectedProduct && (
                            <div className="bg-gradient-to-r from-red-50 to-orange-50 rounded-xl shadow-lg p-6 border-2 border-red-200">
                                <h3 className="text-xl font-bold mb-4 text-red-700">
                                    Agregar: {selectedProduct.nombre}
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2 flex items-center gap-2">
                                            Cantidad (Kg)
                                            {balanzaConfig.habilitada && (
                                                <span className={`text-xs px-2 py-1 rounded ${usarPesoAutomatico ? 'bg-green-100 text-green-700' : 'bg-gray-200 text-gray-600'}`}>
                                                    {usarPesoAutomatico ? 'üîÑ Autom√°tico' : '‚úã Manual'}
                                                </span>
                                            )}
                                        </label>
                                        <input
                                            type="number"
                                            step="0.01"
                                            min="0"
                                            max={selectedProduct.stock}
                                            value={weight}
                                            onChange={(e) => {
                                                setWeight(e.target.value);
                                                if (usarPesoAutomatico) {
                                                    setUsarPesoAutomatico(false);
                                                    showNotification('Cambiado a modo manual', 'info');
                                                }
                                            }}
                                            placeholder="0.00"
                                            className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500 text-lg font-semibold"
                                            onKeyPress={(e) => e.key === 'Enter' && addToCart()}
                                            disabled={balanzaConfig.habilitada && usarPesoAutomatico}
                                        />
                                        <p className="text-xs text-gray-600 mt-1">
                                            Disponible: {selectedProduct.stock} Kg
                                            {balanzaConfig.habilitada && usarPesoAutomatico && (
                                                <span className="text-green-600 ml-2">‚Ä¢ Esperando balanza...</span>
                                            )}
                                        </p>
                                    </div>
                                    <div className="flex flex-col justify-center">
                                        <p className="text-sm text-gray-600 mb-2">Subtotal:</p>
                                        <p className="text-3xl font-bold text-red-600">
                                            ${(parseFloat(weight || 0) * selectedProduct.precioVenta).toLocaleString('es-CO')}
                                        </p>
                                        <p className="text-xs text-green-600 mt-1">
                                            Utilidad: ${((selectedProduct.precioVenta - selectedProduct.precioCompra) * parseFloat(weight || 0)).toLocaleString('es-CO')}
                                        </p>
                                    </div>
                                </div>
                                <div className="mt-4 flex gap-3">
                                    {balanzaConfig.habilitada && (
                                        <button
                                            onClick={() => {
                                                setUsarPesoAutomatico(!usarPesoAutomatico);
                                                if (!usarPesoAutomatico) {
                                                    showNotification('Modo autom√°tico activado', 'success');
                                                } else {
                                                    showNotification('Modo manual activado', 'info');
                                                }
                                            }}
                                            className={`px-6 py-3 rounded-lg font-bold transition-all ${
                                                usarPesoAutomatico 
                                                    ? 'bg-gray-500 text-white hover:bg-gray-600' 
                                                    : 'bg-green-600 text-white hover:bg-green-700'
                                            }`}
                                        >
                                            {usarPesoAutomatico ? '‚úã Cambiar a Manual' : 'üîÑ Cambiar a Autom√°tico'}
                                        </button>
                                    )}
                                    <button
                                        onClick={addToCart}
                                        className="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-bold text-lg flex items-center justify-center gap-2 transition-all shadow-lg"
                                    >
                                        <Icon name="Plus" className="w-6 h-6" />
                                        Agregar al Carrito
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Carrito */}
                    <div className="space-y-6">
                        <div className="bg-white rounded-xl shadow-lg p-6 sticky top-24">
                            <h3 className="text-2xl font-bold mb-4 flex items-center gap-2">
                                <Icon name="ShoppingCart" className="w-7 h-7 text-red-600" />
                                Carrito ({cart.length})
                            </h3>
                            
                            <div className="space-y-3 max-h-96 overflow-y-auto mb-4">
                                {cart.length === 0 ? (
                                    <p className="text-center text-gray-400 py-8">
                                        El carrito est√° vac√≠o
                                    </p>
                                ) : (
                                    cart.map(item => (
                                        <div key={item.id} className="p-4 bg-gray-50 rounded-lg border-2 border-gray-200">
                                            <div className="flex justify-between items-start mb-2">
                                                <h4 className="font-bold">{item.name}</h4>
                                                <button
                                                    onClick={() => removeFromCart(item.id)}
                                                    className="text-red-600 hover:text-red-800 p-1 hover:bg-red-100 rounded"
                                                >
                                                    <Icon name="Trash" className="w-5 h-5" />
                                                </button>
                                            </div>
                                            <div className="text-sm space-y-1">
                                                <p className="text-gray-600">
                                                    {item.weight} Kg √ó ${item.pricePerKg.toLocaleString('es-CO')}
                                                </p>
                                                <p className="font-bold text-lg text-red-600">
                                                    ${item.subtotal.toLocaleString('es-CO')}
                                                </p>
                                                <p className="text-xs text-green-600">
                                                    +${item.utilidad.toLocaleString('es-CO')} utilidad
                                                </p>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>

                            {cart.length > 0 && (
                                <>
                                    <div className="border-t-2 pt-4 space-y-3 mb-4">
                                        <div className="flex justify-between items-center">
                                            <span className="font-semibold">Subtotal:</span>
                                            <span className="text-xl font-bold">${(cartTotal / 1.19).toLocaleString('es-CO', {maximumFractionDigits: 0})}</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="font-semibold">IVA (19%):</span>
                                            <span className="text-xl font-bold">${(cartTotal - cartTotal / 1.19).toLocaleString('es-CO', {maximumFractionDigits: 0})}</span>
                                        </div>
                                        <div className="flex justify-between items-center pt-2 border-t-2">
                                            <span className="text-lg font-bold">TOTAL:</span>
                                            <span className="text-3xl font-bold text-red-600">${cartTotal.toLocaleString('es-CO')}</span>
                                        </div>
                                        <div className="flex justify-between items-center p-3 bg-green-50 rounded-lg border-2 border-green-200">
                                            <span className="font-semibold text-green-700">Utilidad:</span>
                                            <span className="text-xl font-bold text-green-600">+${cartUtilidad.toLocaleString('es-CO')}</span>
                                        </div>
                                    </div>

                                    <div className="space-y-2">
                                        <button
                                            onClick={() => processSale('Efectivo')}
                                            className="w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 font-bold text-lg flex items-center justify-center gap-2 shadow-lg"
                                        >
                                            <Icon name="DollarSign" className="w-6 h-6" />
                                            Efectivo
                                        </button>
                                        <button
                                            onClick={() => processSale('Tarjeta')}
                                            className="w-full bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 font-bold text-lg flex items-center justify-center gap-2 shadow-lg"
                                        >
                                            <Icon name="CreditCard" className="w-6 h-6" />
                                            Tarjeta
                                        </button>
                                        <button
                                            onClick={() => processSale('Transferencia')}
                                            className="w-full bg-purple-600 text-white py-4 rounded-lg hover:bg-purple-700 font-bold text-lg flex items-center justify-center gap-2 shadow-lg"
                                        >
                                            <Icon name="TrendingUp" className="w-6 h-6" />
                                            Transferencia
                                        </button>
                                        <button
                                            onClick={() => setCart([])}
                                            className="w-full bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-semibold"
                                        >
                                            Limpiar
                                        </button>
                                    </div>
                                </>
                            )}
                        </div>
                    </div>

                    {/* Modal de factura */}
                    {showInvoiceModal && saleForInvoice && (
                        <InvoiceModal
                            saleForInvoice={saleForInvoice}
                            clientes={clientes}
                            dianConfig={dianConfig}
                            setShowInvoiceModal={setShowInvoiceModal}
                            setCart={setCart}
                        />
                    )}
                </div>
            );
        }

        // ==================== TAB DE PRODUCTOS (continuaci√≥n en siguiente mensaje) ====================
        // [El resto de componentes contin√∫an igual que en la versi√≥n anterior, agregando solo el campo codigoBarras en ProductosTab]

        function ProductosTab({ productos, setProductos, showNotification }) {
            const [showModal, setShowModal] = useState(false);
            const [editingProduct, setEditingProduct] = useState(null);
            const [formData, setFormData] = useState({
                nombre: '',
                codigoBarras: '',
                precioCompra: '',
                precioVenta: '',
                stock: '',
                categoria: 'Res'
            });

            const categorias = ['Res', 'Pollo', 'Cerdo', 'Embutidos', 'Visceras', 'Otros'];

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.nombre || !formData.precioCompra || !formData.precioVenta || !formData.stock) {
                    showNotification('Completa todos los campos obligatorios', 'error');
                    return;
                }

                if (parseFloat(formData.precioVenta) <= parseFloat(formData.precioCompra)) {
                    showNotification('El precio de venta debe ser mayor al precio de compra', 'error');
                    return;
                }

                // Verificar c√≥digo de barras duplicado
                if (formData.codigoBarras) {
                    const existe = productos.some(p => 
                        p.codigoBarras === formData.codigoBarras && p.id !== editingProduct?.id
                    );
                    if (existe) {
                        showNotification('El c√≥digo de barras ya existe', 'error');
                        return;
                    }
                }

                if (editingProduct) {
                    const updatedProductos = productos.map(p =>
                        p.id === editingProduct.id
                            ? {
                                ...p,
                                nombre: formData.nombre,
                                codigoBarras: formData.codigoBarras,
                                precioCompra: parseFloat(formData.precioCompra),
                                precioVenta: parseFloat(formData.precioVenta),
                                stock: parseFloat(formData.stock),
                                categoria: formData.categoria
                            }
                            : p
                    );
                    setProductos(updatedProductos);
                    showNotification('Producto actualizado exitosamente', 'success');
                } else {
                    const newProduct = {
                        id: Date.now().toString(),
                        nombre: formData.nombre,
                        codigoBarras: formData.codigoBarras,
                        precioCompra: parseFloat(formData.precioCompra),
                        precioVenta: parseFloat(formData.precioVenta),
                        stock: parseFloat(formData.stock),
                        categoria: formData.categoria,
                        fechaCreacion: new Date().toISOString()
                    };
                    setProductos([...productos, newProduct]);
                    showNotification('Producto agregado exitosamente', 'success');
                }

                setShowModal(false);
                setEditingProduct(null);
                setFormData({ nombre: '', codigoBarras: '', precioCompra: '', precioVenta: '', stock: '', categoria: 'Res' });
            };

            const handleEdit = (producto) => {
                setEditingProduct(producto);
                setFormData({
                    nombre: producto.nombre,
                    codigoBarras: producto.codigoBarras || '',
                    precioCompra: producto.precioCompra.toString(),
                    precioVenta: producto.precioVenta.toString(),
                    stock: producto.stock.toString(),
                    categoria: producto.categoria
                });
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (confirm('¬øEst√°s seguro de eliminar este producto?')) {
                    setProductos(productos.filter(p => p.id !== id));
                    showNotification('Producto eliminado', 'info');
                }
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <div className="flex justify-between items-center">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800">Gesti√≥n de Productos</h2>
                                <p className="text-gray-600 mt-1">Total: {productos.length} productos</p>
                            </div>
                            <button
                                onClick={() => {
                                    setEditingProduct(null);
                                    setFormData({ nombre: '', codigoBarras: '', precioCompra: '', precioVenta: '', stock: '', categoria: 'Res' });
                                    setShowModal(true);
                                }}
                                className="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-semibold flex items-center gap-2 shadow-lg"
                            >
                                <Icon name="Plus" className="w-5 h-5" />
                                Nuevo Producto
                            </button>
                        </div>
                    </div>

                    {/* Estad√≠sticas */}
                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white rounded-xl p-6 shadow-lg">
                            <Icon name="Package" className="w-8 h-8 mb-3" />
                            <p className="text-sm opacity-90">Total Productos</p>
                            <p className="text-3xl font-bold mt-1">{productos.length}</p>
                        </div>
                        <div className="bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl p-6 shadow-lg">
                            <Icon name="TrendingUp" className="w-8 h-8 mb-3" />
                            <p className="text-sm opacity-90">Stock Total (Kg)</p>
                            <p className="text-3xl font-bold mt-1">{productos.reduce((sum, p) => sum + p.stock, 0).toFixed(1)}</p>
                        </div>
                        <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white rounded-xl p-6 shadow-lg">
                            <Icon name="DollarSign" className="w-8 h-8 mb-3" />
                            <p className="text-sm opacity-90">Valor Inventario</p>
                            <p className="text-3xl font-bold mt-1">${(productos.reduce((sum, p) => sum + (p.precioCompra * p.stock), 0) / 1000).toFixed(0)}K</p>
                        </div>
                        <div className="bg-gradient-to-br from-yellow-500 to-yellow-600 text-white rounded-xl p-6 shadow-lg">
                            <Icon name="TrendingUp" className="w-8 h-8 mb-3" />
                            <p className="text-sm opacity-90">Utilidad Potencial</p>
                            <p className="text-3xl font-bold mt-1">${(productos.reduce((sum, p) => sum + ((p.precioVenta - p.precioCompra) * p.stock), 0) / 1000).toFixed(0)}K</p>
                        </div>
                    </div>

                    {/* Tabla */}
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gradient-to-r from-red-600 to-red-700 text-white">
                                    <tr>
                                        <th className="px-6 py-4 text-left font-semibold">Producto</th>
                                        <th className="px-6 py-4 text-left font-semibold">C√≥digo</th>
                                        <th className="px-6 py-4 text-left font-semibold">Categor√≠a</th>
                                        <th className="px-6 py-4 text-right font-semibold">P. Compra</th>
                                        <th className="px-6 py-4 text-right font-semibold">P. Venta</th>
                                        <th className="px-6 py-4 text-right font-semibold">Stock</th>
                                        <th className="px-6 py-4 text-right font-semibold">Utilidad/Kg</th>
                                        <th className="px-6 py-4 text-center font-semibold">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {productos.map((producto, index) => (
                                        <tr key={producto.id} className={`hover:bg-gray-50 transition-colors ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
                                            <td className="px-6 py-4">
                                                <div className="font-bold text-gray-800">{producto.nombre}</div>
                                            </td>
                                            <td className="px-6 py-4">
                                                {producto.codigoBarras ? (
                                                    <div className="flex items-center gap-1 text-sm">
                                                        <Icon name="Barcode" className="w-4 h-4 text-gray-500" />
                                                        <span className="font-mono">{producto.codigoBarras}</span>
                                                    </div>
                                                ) : (
                                                    <span className="text-gray-400 text-sm">Sin c√≥digo</span>
                                                )}
                                            </td>
                                            <td className="px-6 py-4">
                                                <span className="px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-800">
                                                    {producto.categoria}
                                                </span>
                                            </td>
                                            <td className="px-6 py-4 text-right font-semibold text-gray-700">
                                                ${producto.precioCompra.toLocaleString('es-CO')}
                                            </td>
                                            <td className="px-6 py-4 text-right font-bold text-red-600">
                                                ${producto.precioVenta.toLocaleString('es-CO')}
                                            </td>
                                            <td className="px-6 py-4 text-right">
                                                <span className={`px-3 py-1 rounded-full font-bold ${
                                                    producto.stock > 10 ? 'bg-green-100 text-green-800' :
                                                    producto.stock > 0 ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-red-100 text-red-800'
                                                }`}>
                                                    {producto.stock} Kg
                                                </span>
                                            </td>
                                            <td className="px-6 py-4 text-right font-bold text-green-600">
                                                +${(producto.precioVenta - producto.precioCompra).toLocaleString('es-CO')}
                                            </td>
                                            <td className="px-6 py-4">
                                                <div className="flex justify-center gap-2">
                                                    <button
                                                        onClick={() => handleEdit(producto)}
                                                        className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg"
                                                    >
                                                        <Icon name="Edit" className="w-5 h-5" />
                                                    </button>
                                                    <button
                                                        onClick={() => handleDelete(producto.id)}
                                                        className="p-2 text-red-600 hover:bg-red-100 rounded-lg"
                                                    >
                                                        <Icon name="Trash" className="w-5 h-5" />
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">
                                        {editingProduct ? 'Editar Producto' : 'Nuevo Producto'}
                                    </h2>
                                    <button
                                        onClick={() => setShowModal(false)}
                                        className="text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-full"
                                    >
                                        <Icon name="X" className="w-6 h-6" />
                                    </button>
                                </div>

                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Nombre del Producto *</label>
                                            <input
                                                type="text"
                                                value={formData.nombre}
                                                onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}
                                                className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                                placeholder="Carne de Res"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2 flex items-center gap-2">
                                                <Icon name="Barcode" className="w-4 h-4" />
                                                C√≥digo de Barras
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.codigoBarras}
                                                onChange={(e) => setFormData({ ...formData, codigoBarras: e.target.value })}
                                                className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500 font-mono"
                                                placeholder="7501234567890"
                                            />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Categor√≠a *</label>
                                        <select
                                            value={formData.categoria}
                                            onChange={(e) => setFormData({ ...formData, categoria: e.target.value })}
                                            className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                        >
                                            {categorias.map(cat => (
                                                <option key={cat} value={cat}>{cat}</option>
                                            ))}
                                        </select>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Precio Compra (COP) *</label>
                                            <input
                                                type="number"
                                                step="1"
                                                min="0"
                                                value={formData.precioCompra}
                                                onChange={(e) => setFormData({ ...formData, precioCompra: e.target.value })}
                                                className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                                placeholder="15000"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Precio Venta (COP) *</label>
                                            <input
                                                type="number"
                                                step="1"
                                                min="0"
                                                value={formData.precioVenta}
                                                onChange={(e) => setFormData({ ...formData, precioVenta: e.target.value })}
                                                className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                                placeholder="22000"
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Stock (Kg) *</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                min="0"
                                                value={formData.stock}
                                                onChange={(e) => setFormData({ ...formData, stock: e.target.value })}
                                                className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                                placeholder="50"
                                                required
                                            />
                                        </div>
                                    </div>

                                    {formData.precioCompra && formData.precioVenta && (
                                        <div className="p-4 bg-green-50 border-2 border-green-200 rounded-lg">
                                            <p className="text-sm font-semibold text-green-800 mb-1">Utilidad por Kg:</p>
                                            <p className="text-2xl font-bold text-green-600">
                                                +${(parseFloat(formData.precioVenta || 0) - parseFloat(formData.precioCompra || 0)).toLocaleString('es-CO')}
                                            </p>
                                        </div>
                                    )}

                                    <div className="flex gap-3 pt-4">
                                        <button
                                            type="button"
                                            onClick={() => setShowModal(false)}
                                            className="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-semibold"
                                        >
                                            Cancelar
                                        </button>
                                        <button
                                            type="submit"
                                            className="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-semibold"
                                        >
                                            {editingProduct ? 'Actualizar' : 'Crear'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // Los dem√°s componentes (HistorialTab, ReportesTab, ClientesTab) permanecen igual

        // ==================== TAB DE USUARIOS ====================
        function UsuariosTab({ usuarios, setUsuarios, currentUser, showNotification }) {
            const [showModal, setShowModal] = useState(false);
            const [editingUser, setEditingUser] = useState(null);
            const [formData, setFormData] = useState({
                username: '',
                password: '',
                nombre: '',
                rol: 'vendedor'
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                
                if (!formData.username || !formData.password || !formData.nombre) {
                    showNotification('Completa todos los campos', 'error');
                    return;
                }

                // Verificar username duplicado
                const existe = usuarios.some(u => 
                    u.username === formData.username && u.id !== editingUser?.id
                );
                if (existe) {
                    showNotification('El nombre de usuario ya existe', 'error');
                    return;
                }

                if (editingUser) {
                    const updatedUsuarios = usuarios.map(u =>
                        u.id === editingUser.id
                            ? { ...u, ...formData }
                            : u
                    );
                    setUsuarios(updatedUsuarios);
                    showNotification('Usuario actualizado', 'success');
                } else {
                    const newUser = {
                        id: Date.now().toString(),
                        ...formData,
                        fechaCreacion: new Date().toISOString()
                    };
                    setUsuarios([...usuarios, newUser]);
                    showNotification('Usuario creado exitosamente', 'success');
                }

                setShowModal(false);
                setEditingUser(null);
                setFormData({ username: '', password: '', nombre: '', rol: 'vendedor' });
            };

            const handleEdit = (usuario) => {
                setEditingUser(usuario);
                setFormData({
                    username: usuario.username,
                    password: usuario.password,
                    nombre: usuario.nombre,
                    rol: usuario.rol
                });
                setShowModal(true);
            };

            const handleDelete = (id) => {
                if (id === currentUser.id) {
                    showNotification('No puedes eliminar tu propio usuario', 'error');
                    return;
                }
                if (confirm('¬øEst√°s seguro de eliminar este usuario?')) {
                    setUsuarios(usuarios.filter(u => u.id !== id));
                    showNotification('Usuario eliminado', 'info');
                }
            };

            return (
                <div className="space-y-6">
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <div className="flex justify-between items-center">
                            <div>
                                <h2 className="text-2xl font-bold text-gray-800">Gesti√≥n de Usuarios</h2>
                                <p className="text-gray-600 mt-1">Total: {usuarios.length} usuarios</p>
                            </div>
                            <button
                                onClick={() => {
                                    setEditingUser(null);
                                    setFormData({ username: '', password: '', nombre: '', rol: 'vendedor' });
                                    setShowModal(true);
                                }}
                                className="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-semibold flex items-center gap-2 shadow-lg"
                            >
                                <Icon name="Plus" className="w-5 h-5" />
                                Nuevo Usuario
                            </button>
                        </div>
                    </div>

                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <table className="w-full">
                            <thead className="bg-gradient-to-r from-red-600 to-red-700 text-white">
                                <tr>
                                    <th className="px-6 py-4 text-left font-semibold">Usuario</th>
                                    <th className="px-6 py-4 text-left font-semibold">Nombre</th>
                                    <th className="px-6 py-4 text-left font-semibold">Rol</th>
                                    <th className="px-6 py-4 text-left font-semibold">Fecha Creaci√≥n</th>
                                    <th className="px-6 py-4 text-center font-semibold">Acciones</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-gray-200">
                                {usuarios.map((usuario, index) => (
                                    <tr key={usuario.id} className={`hover:bg-gray-50 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
                                        <td className="px-6 py-4">
                                            <div className="flex items-center gap-2">
                                                <Icon name="User" className="w-5 h-5 text-gray-500" />
                                                <span className="font-semibold">{usuario.username}</span>
                                                {usuario.id === currentUser.id && (
                                                    <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">T√∫</span>
                                                )}
                                            </div>
                                        </td>
                                        <td className="px-6 py-4 font-semibold">{usuario.nombre}</td>
                                        <td className="px-6 py-4">
                                            <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                usuario.rol === 'admin' 
                                                    ? 'bg-purple-100 text-purple-800' 
                                                    : 'bg-blue-100 text-blue-800'
                                            }`}>
                                                {usuario.rol === 'admin' ? 'Administrador' : 'Vendedor'}
                                            </span>
                                        </td>
                                        <td className="px-6 py-4 text-sm text-gray-600">
                                            {new Date(usuario.fechaCreacion).toLocaleDateString('es-CO')}
                                        </td>
                                        <td className="px-6 py-4">
                                            <div className="flex justify-center gap-2">
                                                <button
                                                    onClick={() => handleEdit(usuario)}
                                                    className="p-2 text-blue-600 hover:bg-blue-100 rounded-lg"
                                                >
                                                    <Icon name="Edit" className="w-5 h-5" />
                                                </button>
                                                {usuario.id !== currentUser.id && (
                                                    <button
                                                        onClick={() => handleDelete(usuario.id)}
                                                        className="p-2 text-red-600 hover:bg-red-100 rounded-lg"
                                                    >
                                                        <Icon name="Trash" className="w-5 h-5" />
                                                    </button>
                                                )}
                                            </div>
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-xl max-w-md w-full p-6">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold">
                                        {editingUser ? 'Editar Usuario' : 'Nuevo Usuario'}
                                    </h2>
                                    <button
                                        onClick={() => setShowModal(false)}
                                        className="text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-full"
                                    >
                                        <Icon name="X" className="w-6 h-6" />
                                    </button>
                                </div>

                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Nombre Completo *</label>
                                        <input
                                            type="text"
                                            value={formData.nombre}
                                            onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}
                                            className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                            placeholder="Juan P√©rez"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Usuario *</label>
                                        <input
                                            type="text"
                                            value={formData.username}
                                            onChange={(e) => setFormData({ ...formData, username: e.target.value })}
                                            className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                            placeholder="juanperez"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Contrase√±a *</label>
                                        <input
                                            type="password"
                                            value={formData.password}
                                            onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                                            className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium mb-2">Rol *</label>
                                        <select
                                            value={formData.rol}
                                            onChange={(e) => setFormData({ ...formData, rol: e.target.value })}
                                            className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                        >
                                            <option value="vendedor">Vendedor</option>
                                            <option value="admin">Administrador</option>
                                        </select>
                                    </div>

                                    <div className="flex gap-3 pt-4">
                                        <button
                                            type="button"
                                            onClick={() => setShowModal(false)}
                                            className="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-semibold"
                                        >
                                            Cancelar
                                        </button>
                                        <button
                                            type="submit"
                                            className="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-semibold"
                                        >
                                            {editingUser ? 'Actualizar' : 'Crear'}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // [Continuar√© con los tabs restantes en el pr√≥ximo mensaje debido al l√≠mite de caracteres]
        
        // Por brevedad, incluyo solo las firmas de los componentes restantes que son similares a la versi√≥n anterior
        // pero agregar√© el nuevo ConfiguracionTab completo con todos los campos DIAN

        function HistorialTab({ ventas, productos, clientes, showNotification }) {
            const [filtroFecha, setFiltroFecha] = useState('hoy');
            const [searchTerm, setSearchTerm] = useState('');

            // Filtrar ventas por fecha
            const ventasFiltradas = ventas.filter(venta => {
                const fechaVenta = new Date(venta.fecha);
                const hoy = new Date();
                hoy.setHours(0, 0, 0, 0);

                let mostrar = false;
                if (filtroFecha === 'hoy') {
                    mostrar = fechaVenta >= hoy;
                } else if (filtroFecha === 'semana') {
                    const inicioSemana = new Date(hoy);
                    inicioSemana.setDate(hoy.getDate() - 7);
                    mostrar = fechaVenta >= inicioSemana;
                } else if (filtroFecha === 'mes') {
                    const inicioMes = new Date(hoy);
                    inicioMes.setDate(1);
                    mostrar = fechaVenta >= inicioMes;
                } else {
                    mostrar = true; // 'todas'
                }

                // Filtro de b√∫squeda
                if (searchTerm && mostrar) {
                    const searchLower = searchTerm.toLowerCase();
                    mostrar = venta.clienteNombre.toLowerCase().includes(searchLower) ||
                             venta.numeroFactura.toLowerCase().includes(searchLower) ||
                             venta.tipoPago.toLowerCase().includes(searchLower) ||
                             venta.vendedor.toLowerCase().includes(searchLower);
                }

                return mostrar;
            });

            return (
                <div className="space-y-6">
                    {/* Filtros */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                            <Icon name="Clock" className="w-7 h-7 text-red-600" />
                            Historial de Ventas
                        </h2>
                        
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium mb-2">Filtrar por per√≠odo</label>
                                <select
                                    value={filtroFecha}
                                    onChange={(e) => setFiltroFecha(e.target.value)}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                >
                                    <option value="hoy">Hoy</option>
                                    <option value="semana">√öltima Semana</option>
                                    <option value="mes">Este Mes</option>
                                    <option value="todas">Todas</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-2">Buscar</label>
                                <input
                                    type="text"
                                    placeholder="Cliente, Factura, Vendedor..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                                />
                            </div>
                        </div>

                        <div className="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                                <p className="text-sm text-blue-600 font-semibold">Total Ventas</p>
                                <p className="text-2xl font-bold text-blue-700">{ventasFiltradas.length}</p>
                            </div>
                            <div className="bg-green-50 p-4 rounded-lg border-2 border-green-200">
                                <p className="text-sm text-green-600 font-semibold">Total Recaudado</p>
                                <p className="text-2xl font-bold text-green-700">
                                    ${ventasFiltradas.reduce((sum, v) => sum + v.total, 0).toLocaleString('es-CO')}
                                </p>
                            </div>
                            <div className="bg-purple-50 p-4 rounded-lg border-2 border-purple-200">
                                <p className="text-sm text-purple-600 font-semibold">Utilidad Total</p>
                                <p className="text-2xl font-bold text-purple-700">
                                    +${ventasFiltradas.reduce((sum, v) => sum + v.utilidadTotal, 0).toLocaleString('es-CO')}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Lista de ventas */}
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        {ventasFiltradas.length === 0 ? (
                            <div className="p-12 text-center text-gray-400">
                                <Icon name="ShoppingCart" className="w-16 h-16 mx-auto mb-4 opacity-50" />
                                <p className="text-xl font-semibold">No hay ventas para mostrar</p>
                            </div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gradient-to-r from-red-600 to-red-700 text-white">
                                        <tr>
                                            <th className="px-6 py-4 text-left font-semibold">Factura</th>
                                            <th className="px-6 py-4 text-left font-semibold">Fecha/Hora</th>
                                            <th className="px-6 py-4 text-left font-semibold">Cliente</th>
                                            <th className="px-6 py-4 text-left font-semibold">Items</th>
                                            <th className="px-6 py-4 text-left font-semibold">Pago</th>
                                            <th className="px-6 py-4 text-right font-semibold">Total</th>
                                            <th className="px-6 py-4 text-right font-semibold">Utilidad</th>
                                            <th className="px-6 py-4 text-left font-semibold">Vendedor</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-gray-200">
                                        {ventasFiltradas.map((venta, index) => (
                                            <tr key={venta.id} className={`hover:bg-gray-50 ${index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}`}>
                                                <td className="px-6 py-4">
                                                    <span className="font-mono font-bold text-red-600">
                                                        {venta.numeroFactura}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 text-sm">
                                                    <div>
                                                        <p className="font-semibold">
                                                            {new Date(venta.fecha).toLocaleDateString('es-CO')}
                                                        </p>
                                                        <p className="text-gray-500">
                                                            {new Date(venta.fecha).toLocaleTimeString('es-CO')}
                                                        </p>
                                                    </div>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <span className="font-semibold">{venta.clienteNombre}</span>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-bold">
                                                        {venta.items.length} items
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                        venta.tipoPago === 'Efectivo' ? 'bg-green-100 text-green-800' :
                                                        venta.tipoPago === 'Tarjeta' ? 'bg-blue-100 text-blue-800' :
                                                        'bg-purple-100 text-purple-800'
                                                    }`}>
                                                        {venta.tipoPago}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 text-right">
                                                    <span className="font-bold text-lg text-red-600">
                                                        ${venta.total.toLocaleString('es-CO')}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4 text-right">
                                                    <span className="font-bold text-green-600">
                                                        +${venta.utilidadTotal.toLocaleString('es-CO')}
                                                    </span>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <div className="flex items-center gap-2">
                                                        <Icon name="User" className="w-4 h-4 text-gray-500" />
                                                        <span className="text-sm">{venta.vendedor}</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function ReportesTab({ ventas, productos, showNotification }) {
            const [fechaReporte, setFechaReporte] = useState(new Date().toISOString().split('T')[0]);

            // Calcular datos del reporte
            const ventasDelDia = ventas.filter(venta => {
                const fechaVenta = new Date(venta.fecha).toISOString().split('T')[0];
                return fechaVenta === fechaReporte;
            });

            const ventasPorMedioPago = {
                'Efectivo': ventasDelDia.filter(v => v.tipoPago === 'Efectivo'),
                'Tarjeta': ventasDelDia.filter(v => v.tipoPago === 'Tarjeta'),
                'Transferencia': ventasDelDia.filter(v => v.tipoPago === 'Transferencia')
            };

            const totalEfectivo = ventasPorMedioPago['Efectivo'].reduce((sum, v) => sum + v.total, 0);
            const totalTarjeta = ventasPorMedioPago['Tarjeta'].reduce((sum, v) => sum + v.total, 0);
            const totalTransferencia = ventasPorMedioPago['Transferencia'].reduce((sum, v) => sum + v.total, 0);
            const totalDia = totalEfectivo + totalTarjeta + totalTransferencia;
            const utilidadDia = ventasDelDia.reduce((sum, v) => sum + v.utilidadTotal, 0);

            // Funci√≥n para imprimir reporte
            const imprimirReporte = () => {
                const w = window.open('', '_blank');
                w.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Reporte Diario - ${new Date(fechaReporte).toLocaleDateString('es-CO')}</title>
                        <style>
                            * { margin: 0; padding: 0; box-sizing: border-box; }
                            body { 
                                font-family: Arial, sans-serif; 
                                padding: 20px;
                                background: white;
                            }
                            .header {
                                text-align: center;
                                margin-bottom: 30px;
                                border-bottom: 3px solid #dc2626;
                                padding-bottom: 20px;
                            }
                            h1 { 
                                color: #dc2626; 
                                font-size: 28px;
                                margin-bottom: 10px;
                            }
                            .fecha {
                                font-size: 18px;
                                color: #666;
                                font-weight: bold;
                            }
                            .section {
                                margin: 30px 0;
                                padding: 20px;
                                background: #f9fafb;
                                border-radius: 8px;
                                border: 2px solid #e5e7eb;
                            }
                            .section-title {
                                font-size: 20px;
                                font-weight: bold;
                                color: #374151;
                                margin-bottom: 15px;
                                display: flex;
                                align-items: center;
                                gap: 10px;
                            }
                            table {
                                width: 100%;
                                border-collapse: collapse;
                                margin: 15px 0;
                                background: white;
                            }
                            th, td {
                                padding: 12px;
                                text-align: left;
                                border: 1px solid #e5e7eb;
                            }
                            th {
                                background: #dc2626;
                                color: white;
                                font-weight: bold;
                            }
                            .total-row {
                                background: #fef2f2;
                                font-weight: bold;
                                font-size: 16px;
                            }
                            .total-row td {
                                color: #dc2626;
                                border-top: 3px solid #dc2626;
                            }
                            .resumen {
                                display: grid;
                                grid-template-columns: repeat(2, 1fr);
                                gap: 15px;
                                margin: 20px 0;
                            }
                            .resumen-item {
                                padding: 15px;
                                background: white;
                                border-radius: 8px;
                                border: 2px solid #e5e7eb;
                            }
                            .resumen-item h3 {
                                font-size: 14px;
                                color: #6b7280;
                                margin-bottom: 5px;
                            }
                            .resumen-item p {
                                font-size: 24px;
                                font-weight: bold;
                            }
                            .efectivo { color: #059669; }
                            .tarjeta { color: #2563eb; }
                            .transferencia { color: #7c3aed; }
                            .total-general { color: #dc2626; }
                            .utilidad { color: #059669; }
                            .footer {
                                margin-top: 40px;
                                text-align: center;
                                padding-top: 20px;
                                border-top: 2px solid #e5e7eb;
                                color: #6b7280;
                                font-size: 12px;
                            }
                            @media print {
                                .no-print { display: none; }
                                body { padding: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>üìä REPORTE DIARIO DE VENTAS</h1>
                            <p class="fecha">${new Date(fechaReporte).toLocaleDateString('es-CO', { 
                                weekday: 'long', 
                                year: 'numeric', 
                                month: 'long', 
                                day: 'numeric' 
                            })}</p>
                        </div>

                        <div class="section">
                            <h2 class="section-title">üí∞ Resumen por Medio de Pago</h2>
                            <div class="resumen">
                                <div class="resumen-item">
                                    <h3>Efectivo</h3>
                                    <p class="efectivo">$${totalEfectivo.toLocaleString('es-CO')}</p>
                                    <small>${ventasPorMedioPago['Efectivo'].length} ventas</small>
                                </div>
                                <div class="resumen-item">
                                    <h3>Tarjeta</h3>
                                    <p class="tarjeta">$${totalTarjeta.toLocaleString('es-CO')}</p>
                                    <small>${ventasPorMedioPago['Tarjeta'].length} ventas</small>
                                </div>
                                <div class="resumen-item">
                                    <h3>Transferencia</h3>
                                    <p class="transferencia">$${totalTransferencia.toLocaleString('es-CO')}</p>
                                    <small>${ventasPorMedioPago['Transferencia'].length} ventas</small>
                                </div>
                                <div class="resumen-item">
                                    <h3>Total del D√≠a</h3>
                                    <p class="total-general">$${totalDia.toLocaleString('es-CO')}</p>
                                    <small>${ventasDelDia.length} ventas totales</small>
                                </div>
                            </div>
                        </div>

                        <div class="section">
                            <h2 class="section-title">üìã Detalle de Ventas</h2>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Factura</th>
                                        <th>Cliente</th>
                                        <th>Medio Pago</th>
                                        <th>Total</th>
                                        <th>Utilidad</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${ventasDelDia.map(venta => `
                                        <tr>
                                            <td>${new Date(venta.fecha).toLocaleTimeString('es-CO')}</td>
                                            <td>${venta.numeroFactura}</td>
                                            <td>${venta.clienteNombre}</td>
                                            <td>${venta.tipoPago}</td>
                                            <td>$${venta.total.toLocaleString('es-CO')}</td>
                                            <td>+$${venta.utilidadTotal.toLocaleString('es-CO')}</td>
                                        </tr>
                                    `).join('')}
                                    <tr class="total-row">
                                        <td colspan="4"><strong>TOTALES DEL D√çA</strong></td>
                                        <td><strong>$${totalDia.toLocaleString('es-CO')}</strong></td>
                                        <td><strong>+$${utilidadDia.toLocaleString('es-CO')}</strong></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="section">
                            <h2 class="section-title">üìà An√°lisis</h2>
                            <div class="resumen">
                                <div class="resumen-item">
                                    <h3>N√∫mero de Ventas</h3>
                                    <p>${ventasDelDia.length}</p>
                                </div>
                                <div class="resumen-item">
                                    <h3>Ticket Promedio</h3>
                                    <p>$${ventasDelDia.length > 0 ? Math.round(totalDia / ventasDelDia.length).toLocaleString('es-CO') : '0'}</p>
                                </div>
                                <div class="resumen-item">
                                    <h3>Utilidad Total</h3>
                                    <p class="utilidad">+$${utilidadDia.toLocaleString('es-CO')}</p>
                                </div>
                                <div class="resumen-item">
                                    <h3>Margen Promedio</h3>
                                    <p>${totalDia > 0 ? ((utilidadDia / totalDia) * 100).toFixed(1) : '0'}%</p>
                                </div>
                            </div>
                        </div>

                        <div class="footer">
                            <p>Reporte generado autom√°ticamente por Sistema de Carnicer√≠a Pro</p>
                            <p>Fecha de impresi√≥n: ${new Date().toLocaleString('es-CO')}</p>
                        </div>

                        <div class="no-print" style="text-align: center; margin-top: 30px;">
                            <button onclick="window.print()" style="background: #dc2626; color: white; border: none; padding: 15px 40px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer;">
                                üñ®Ô∏è Imprimir Reporte
                            </button>
                        </div>
                    </body>
                    </html>
                `);
                w.document.close();
            };

            return (
                <div className="space-y-6">
                    {/* Selector de fecha */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <div className="flex justify-between items-center">
                            <div>
                                <h2 className="text-2xl font-bold flex items-center gap-2">
                                    <Icon name="BarChart" className="w-7 h-7 text-red-600" />
                                    Reporte Diario de Ventas
                                </h2>
                                <p className="text-gray-600 mt-1">An√°lisis detallado por medio de pago</p>
                            </div>
                            <button
                                onClick={imprimirReporte}
                                disabled={ventasDelDia.length === 0}
                                className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 shadow-lg transition-all ${
                                    ventasDelDia.length === 0
                                        ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                        : 'bg-red-600 text-white hover:bg-red-700'
                                }`}
                            >
                                <Icon name="Printer" className="w-5 h-5" />
                                Imprimir Reporte
                            </button>
                        </div>

                        <div className="mt-4">
                            <label className="block text-sm font-medium mb-2">Fecha del Reporte</label>
                            <input
                                type="date"
                                value={fechaReporte}
                                onChange={(e) => setFechaReporte(e.target.value)}
                                max={new Date().toISOString().split('T')[0]}
                                className="w-full md:w-auto px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                            />
                        </div>
                    </div>

                    {ventasDelDia.length === 0 ? (
                        <div className="bg-white rounded-xl shadow-lg p-12 text-center">
                            <Icon name="FileText" className="w-16 h-16 mx-auto mb-4 text-gray-300" />
                            <p className="text-xl font-semibold text-gray-400">No hay ventas para esta fecha</p>
                            <p className="text-gray-500 mt-2">Selecciona otra fecha para ver el reporte</p>
                        </div>
                    ) : (
                        <>
                            {/* Resumen por medio de pago */}
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl shadow-lg border-2 border-green-200">
                                    <div className="flex items-center gap-3 mb-2">
                                        <Icon name="DollarSign" className="w-8 h-8 text-green-600" />
                                        <h3 className="font-semibold text-green-700">Efectivo</h3>
                                    </div>
                                    <p className="text-3xl font-bold text-green-700 mb-1">
                                        ${totalEfectivo.toLocaleString('es-CO')}
                                    </p>
                                    <p className="text-sm text-green-600">
                                        {ventasPorMedioPago['Efectivo'].length} ventas
                                    </p>
                                </div>

                                <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl shadow-lg border-2 border-blue-200">
                                    <div className="flex items-center gap-3 mb-2">
                                        <Icon name="CreditCard" className="w-8 h-8 text-blue-600" />
                                        <h3 className="font-semibold text-blue-700">Tarjeta</h3>
                                    </div>
                                    <p className="text-3xl font-bold text-blue-700 mb-1">
                                        ${totalTarjeta.toLocaleString('es-CO')}
                                    </p>
                                    <p className="text-sm text-blue-600">
                                        {ventasPorMedioPago['Tarjeta'].length} ventas
                                    </p>
                                </div>

                                <div className="bg-gradient-to-br from-purple-50 to-purple-100 p-6 rounded-xl shadow-lg border-2 border-purple-200">
                                    <div className="flex items-center gap-3 mb-2">
                                        <Icon name="TrendingUp" className="w-8 h-8 text-purple-600" />
                                        <h3 className="font-semibold text-purple-700">Transferencia</h3>
                                    </div>
                                    <p className="text-3xl font-bold text-purple-700 mb-1">
                                        ${totalTransferencia.toLocaleString('es-CO')}
                                    </p>
                                    <p className="text-sm text-purple-600">
                                        {ventasPorMedioPago['Transferencia'].length} ventas
                                    </p>
                                </div>

                                <div className="bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-xl shadow-lg border-2 border-red-300">
                                    <div className="flex items-center gap-3 mb-2">
                                        <Icon name="TrendingUp" className="w-8 h-8 text-red-600" />
                                        <h3 className="font-semibold text-red-700">Total del D√≠a</h3>
                                    </div>
                                    <p className="text-3xl font-bold text-red-700 mb-1">
                                        ${totalDia.toLocaleString('es-CO')}
                                    </p>
                                    <p className="text-sm text-red-600">
                                        {ventasDelDia.length} ventas totales
                                    </p>
                                </div>
                            </div>

                            {/* An√°lisis adicional */}
                            <div className="bg-white rounded-xl shadow-lg p-6">
                                <h3 className="text-xl font-bold mb-4 flex items-center gap-2">
                                    <Icon name="PieChart" className="w-6 h-6 text-red-600" />
                                    An√°lisis del D√≠a
                                </h3>
                                <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div className="p-4 bg-gray-50 rounded-lg border-2 border-gray-200">
                                        <p className="text-sm text-gray-600 font-semibold">N√∫mero de Ventas</p>
                                        <p className="text-2xl font-bold text-gray-800">{ventasDelDia.length}</p>
                                    </div>
                                    <div className="p-4 bg-gray-50 rounded-lg border-2 border-gray-200">
                                        <p className="text-sm text-gray-600 font-semibold">Ticket Promedio</p>
                                        <p className="text-2xl font-bold text-gray-800">
                                            ${Math.round(totalDia / ventasDelDia.length).toLocaleString('es-CO')}
                                        </p>
                                    </div>
                                    <div className="p-4 bg-green-50 rounded-lg border-2 border-green-200">
                                        <p className="text-sm text-green-600 font-semibold">Utilidad Total</p>
                                        <p className="text-2xl font-bold text-green-700">
                                            +${utilidadDia.toLocaleString('es-CO')}
                                        </p>
                                    </div>
                                    <div className="p-4 bg-blue-50 rounded-lg border-2 border-blue-200">
                                        <p className="text-sm text-blue-600 font-semibold">Margen Promedio</p>
                                        <p className="text-2xl font-bold text-blue-700">
                                            {((utilidadDia / totalDia) * 100).toFixed(1)}%
                                        </p>
                                    </div>
                                </div>
                            </div>

                            {/* Tabla detallada */}
                            <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                                <div className="p-6 bg-gradient-to-r from-red-600 to-red-700">
                                    <h3 className="text-xl font-bold text-white flex items-center gap-2">
                                        <Icon name="List" className="w-6 h-6" />
                                        Detalle de Ventas
                                    </h3>
                                </div>
                                <div className="overflow-x-auto">
                                    <table className="w-full">
                                        <thead className="bg-gray-100">
                                            <tr>
                                                <th className="px-6 py-3 text-left font-semibold text-gray-700">Hora</th>
                                                <th className="px-6 py-3 text-left font-semibold text-gray-700">Factura</th>
                                                <th className="px-6 py-3 text-left font-semibold text-gray-700">Cliente</th>
                                                <th className="px-6 py-3 text-left font-semibold text-gray-700">Medio Pago</th>
                                                <th className="px-6 py-3 text-right font-semibold text-gray-700">Total</th>
                                                <th className="px-6 py-3 text-right font-semibold text-gray-700">Utilidad</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-gray-200">
                                            {ventasDelDia.map((venta, index) => (
                                                <tr key={venta.id} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                    <td className="px-6 py-4 text-sm">
                                                        {new Date(venta.fecha).toLocaleTimeString('es-CO', {
                                                            hour: '2-digit',
                                                            minute: '2-digit'
                                                        })}
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <span className="font-mono font-bold text-red-600">
                                                            {venta.numeroFactura}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 font-semibold">
                                                        {venta.clienteNombre}
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <span className={`px-3 py-1 rounded-full text-sm font-semibold ${
                                                            venta.tipoPago === 'Efectivo' ? 'bg-green-100 text-green-800' :
                                                            venta.tipoPago === 'Tarjeta' ? 'bg-blue-100 text-blue-800' :
                                                            'bg-purple-100 text-purple-800'
                                                        }`}>
                                                            {venta.tipoPago}
                                                        </span>
                                                    </td>
                                                    <td className="px-6 py-4 text-right font-bold text-red-600">
                                                        ${venta.total.toLocaleString('es-CO')}
                                                    </td>
                                                    <td className="px-6 py-4 text-right font-bold text-green-600">
                                                        +${venta.utilidadTotal.toLocaleString('es-CO')}
                                                    </td>
                                                </tr>
                                            ))}
                                            <tr className="bg-red-50 border-t-4 border-red-600">
                                                <td colSpan="4" className="px-6 py-4 text-right font-bold text-lg">
                                                    TOTALES DEL D√çA:
                                                </td>
                                                <td className="px-6 py-4 text-right font-bold text-xl text-red-600">
                                                    ${totalDia.toLocaleString('es-CO')}
                                                </td>
                                                <td className="px-6 py-4 text-right font-bold text-xl text-green-600">
                                                    +${utilidadDia.toLocaleString('es-CO')}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </>
                    )}
                </div>
            );
        }

        function ClientesTab({ clientes, setClientes, showNotification }) {
            // Mismo c√≥digo que versi√≥n anterior
            return <div>Clientes Tab</div>;
        }

        // ==================== TAB DE CONFIGURACI√ìN COMPLETO ====================
        function ConfiguracionTab({ dianConfig, setDianConfig, balanzaConfig, setBalanzaConfig, productos, ventas, clientes, currentWeight, showNotification }) {
            const [activeSection, setActiveSection] = useState('dian');

            const handleConfigChange = (field, value) => {
                setDianConfig({ ...dianConfig, [field]: value });
            };

            const handleBalanzaChange = (field, value) => {
                setBalanzaConfig({ ...balanzaConfig, [field]: value });
            };

            const handleExportar = () => {
                const data = StorageManager.exportAll();
                const json = JSON.stringify(data, null, 2);
                const blob = new Blob([json], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup-carniceria-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                showNotification('Datos exportados exitosamente', 'success');
            };

            const handleImportar = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        const success = StorageManager.importAll(data);
                        if (success) {
                            showNotification('Datos importados. Recarga la p√°gina.', 'success');
                            setTimeout(() => window.location.reload(), 2000);
                        }
                    } catch (error) {
                        showNotification('Archivo inv√°lido', 'error');
                    }
                };
                reader.readAsText(file);
            };

            return (
                <div className="space-y-6">
                    {/* Selector de secci√≥n */}
                    <div className="bg-white rounded-xl shadow-lg p-4">
                        <div className="flex gap-2 overflow-x-auto">
                            {[
                                { id: 'firebase', label: 'Sincronizaci√≥n en la Nube', icon: 'Cloud' },
                                { id: 'dian', label: 'Configuraci√≥n DIAN', icon: 'Shield' },
                                { id: 'balanza', label: 'Balanza', icon: 'Scale' },
                                { id: 'backup', label: 'Respaldo', icon: 'Download' }
                            ].map(section => (
                                <button
                                    key={section.id}
                                    onClick={() => setActiveSection(section.id)}
                                    className={`flex items-center gap-2 px-6 py-3 rounded-lg font-semibold whitespace-nowrap ${
                                        activeSection === section.id
                                            ? 'bg-red-600 text-white'
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    <Icon name={section.icon} className="w-5 h-5" />
                                    {section.label}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Configuraci√≥n de Firebase */}
                    {activeSection === 'firebase' && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icon name="Cloud" className="w-7 h-7 text-red-600" />
                                Sincronizaci√≥n en la Nube con Firebase
                            </h2>

                            {/* Estado actual */}
                            <div className={`mb-6 p-6 rounded-xl border-2 ${
                                firebaseEnabled 
                                    ? 'bg-green-50 border-green-300' 
                                    : 'bg-yellow-50 border-yellow-300'
                            }`}>
                                <div className="flex items-start gap-4">
                                    <Icon 
                                        name={firebaseEnabled ? "CheckCircle" : "AlertCircle"} 
                                        className={`w-8 h-8 ${firebaseEnabled ? 'text-green-600' : 'text-yellow-600'}`} 
                                    />
                                    <div className="flex-1">
                                        <h3 className={`text-lg font-bold mb-2 ${
                                            firebaseEnabled ? 'text-green-800' : 'text-yellow-800'
                                        }`}>
                                            {firebaseEnabled 
                                                ? '‚úÖ Sincronizaci√≥n Activa' 
                                                : '‚ö†Ô∏è Sincronizaci√≥n No Configurada'
                                            }
                                        </h3>
                                        <p className={firebaseEnabled ? 'text-green-700' : 'text-yellow-700'}>
                                            {firebaseEnabled 
                                                ? 'Tus datos se est√°n guardando autom√°ticamente en la nube y est√°n disponibles en todos tus dispositivos.' 
                                                : 'Actualmente solo usas almacenamiento local. Tus datos solo est√°n en este dispositivo.'
                                            }
                                        </p>
                                        {firebaseEnabled && (
                                            <p className="mt-2 text-sm text-green-600">
                                                <strong>ID de tu tienda:</strong> {StorageManager.storeId}
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Instrucciones */}
                            <div className="space-y-6">
                                <div className="bg-blue-50 p-6 rounded-xl border-2 border-blue-200">
                                    <h3 className="text-lg font-bold mb-4 text-blue-900 flex items-center gap-2">
                                        <Icon name="Info" className="w-6 h-6" />
                                        ¬øQu√© es la Sincronizaci√≥n en la Nube?
                                    </h3>
                                    <div className="space-y-3 text-blue-800">
                                        <p>‚úÖ <strong>Accede desde cualquier dispositivo:</strong> PC, tablet, celular - tus datos siempre disponibles</p>
                                        <p>‚úÖ <strong>Respaldo autom√°tico:</strong> Tus datos est√°n seguros en la nube de Google</p>
                                        <p>‚úÖ <strong>Trabajo en equipo:</strong> Varios dispositivos sincronizados en tiempo real</p>
                                        <p>‚úÖ <strong>100% Gratis:</strong> Firebase ofrece uso gratuito generoso para negocios peque√±os</p>
                                    </div>
                                </div>

                                <div className="bg-gradient-to-r from-gray-50 to-gray-100 p-6 rounded-xl border-2 border-gray-300">
                                    <h3 className="text-lg font-bold mb-4 flex items-center gap-2">
                                        <Icon name="Settings" className="w-6 h-6 text-red-600" />
                                        C√≥mo Activar la Sincronizaci√≥n
                                    </h3>
                                    <div className="space-y-4">
                                        <div className="flex items-start gap-3">
                                            <div className="bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">1</div>
                                            <div>
                                                <p className="font-semibold">Crear cuenta en Firebase</p>
                                                <p className="text-sm text-gray-600">Ve a <a href="https://console.firebase.google.com/" target="_blank" className="text-blue-600 underline">console.firebase.google.com</a> e inicia sesi√≥n con tu cuenta de Google</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">2</div>
                                            <div>
                                                <p className="font-semibold">Crear nuevo proyecto</p>
                                                <p className="text-sm text-gray-600">Haz clic en "Agregar proyecto" y ponle un nombre (ej: "mi-carniceria")</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">3</div>
                                            <div>
                                                <p className="font-semibold">Activar Firestore Database</p>
                                                <p className="text-sm text-gray-600">En el men√∫ lateral, ve a "Firestore Database" y act√≠valo en <strong>modo de prueba</strong></p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">4</div>
                                            <div>
                                                <p className="font-semibold">Obtener configuraci√≥n</p>
                                                <p className="text-sm text-gray-600">Ve a "Configuraci√≥n del proyecto" ‚Üí "Tus apps" ‚Üí Agrega una aplicaci√≥n web (icono &lt;/&gt;)</p>
                                            </div>
                                        </div>
                                        <div className="flex items-start gap-3">
                                            <div className="bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center font-bold flex-shrink-0">5</div>
                                            <div>
                                                <p className="font-semibold">Configurar en el c√≥digo</p>
                                                <p className="text-sm text-gray-600 mb-2">Copia los valores que te muestra Firebase y p√©galos en el c√≥digo HTML (busca "firebaseConfig" al inicio del archivo)</p>
                                                <div className="bg-gray-900 text-green-400 p-3 rounded-lg text-xs font-mono overflow-x-auto">
{`const firebaseConfig = {
    apiKey: "AIzaSy...",
    authDomain: "tu-proyecto.firebaseapp.com",
    projectId: "tu-proyecto-id",
    storageBucket: "tu-proyecto.appspot.com",
    messagingSenderId: "123456789",
    appId: "1:123456789:web:abc123"
};`}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-purple-50 p-6 rounded-xl border-2 border-purple-200">
                                    <h3 className="text-lg font-bold mb-3 text-purple-900 flex items-center gap-2">
                                        <Icon name="HelpCircle" className="w-6 h-6" />
                                        ¬øNecesitas ayuda?
                                    </h3>
                                    <p className="text-purple-800 mb-3">Si necesitas asistencia para configurar Firebase, puedes:</p>
                                    <ul className="space-y-2 text-purple-700">
                                        <li>üìπ Ver tutoriales en YouTube: "Como configurar Firebase"</li>
                                        <li>üìö Leer la documentaci√≥n oficial de Firebase</li>
                                        <li>üí¨ Consultar con un desarrollador o t√©cnico</li>
                                    </ul>
                                </div>

                                {!firebaseEnabled && (
                                    <div className="bg-red-50 p-6 rounded-xl border-2 border-red-300">
                                        <h3 className="text-lg font-bold mb-3 text-red-900 flex items-center gap-2">
                                            <Icon name="AlertCircle" className="w-6 h-6" />
                                            Importante
                                        </h3>
                                        <p className="text-red-800">
                                            Sin sincronizaci√≥n en la nube, tus datos solo est√°n en este dispositivo. 
                                            Si borras el navegador, cambias de dispositivo o reinstalas, <strong>perder√°s toda la informaci√≥n</strong>. 
                                            Te recomendamos configurar Firebase o hacer respaldos regulares.
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Configuraci√≥n DIAN */}
                    {activeSection === 'dian' && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icon name="Shield" className="w-7 h-7 text-red-600" />
                                Configuraci√≥n DIAN Completa
                            </h2>

                            {/* Datos de la Empresa */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4 text-gray-700 border-b-2 pb-2">Datos de la Empresa</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">NIT *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.nit}
                                            onChange={(e) => handleConfigChange('nit', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="900123456-7"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Raz√≥n Social *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.razonSocial}
                                            onChange={(e) => handleConfigChange('razonSocial', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Carnicer√≠a S.A.S"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Nombre Comercial</label>
                                        <input
                                            type="text"
                                            value={dianConfig.nombreComercial}
                                            onChange={(e) => handleConfigChange('nombreComercial', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Carnicer√≠a El Buen Sabor"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Actividad Econ√≥mica (CIIU)</label>
                                        <input
                                            type="text"
                                            value={dianConfig.actividadEconomica}
                                            onChange={(e) => handleConfigChange('actividadEconomica', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="4722 - Comercio al por menor de carnes"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Direcci√≥n *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.direccion}
                                            onChange={(e) => handleConfigChange('direccion', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Calle 123 # 45-67"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Ciudad *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.ciudad}
                                            onChange={(e) => handleConfigChange('ciudad', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Bogot√°"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Departamento *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.departamento}
                                            onChange={(e) => handleConfigChange('departamento', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Cundinamarca"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Tel√©fono *</label>
                                        <input
                                            type="tel"
                                            value={dianConfig.telefono}
                                            onChange={(e) => handleConfigChange('telefono', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="3001234567"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Email *</label>
                                        <input
                                            type="email"
                                            value={dianConfig.email}
                                            onChange={(e) => handleConfigChange('email', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="info@carniceria.com"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Responsabilidades Fiscales */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4 text-gray-700 border-b-2 pb-2">Responsabilidades Fiscales</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Responsabilidad Fiscal *</label>
                                        <select
                                            value={dianConfig.responsabilidadFiscal}
                                            onChange={(e) => handleConfigChange('responsabilidadFiscal', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                        >
                                            <option value="O-13">O-13 - Gran Contribuyente</option>
                                            <option value="O-15">O-15 - Autoretenedor</option>
                                            <option value="O-23">O-23 - Agente de retenci√≥n IVA</option>
                                            <option value="O-47">O-47 - R√©gimen Simple</option>
                                            <option value="R-99-PN">R-99-PN - No responsable IVA</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">R√©gimen Fiscal *</label>
                                        <select
                                            value={dianConfig.regimenFiscal}
                                            onChange={(e) => handleConfigChange('regimenFiscal', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                        >
                                            <option value="Com√∫n">Com√∫n</option>
                                            <option value="Simplificado">Simplificado</option>
                                            <option value="Simple">R√©gimen Simple</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            {/* Resoluci√≥n de Facturaci√≥n */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4 text-gray-700 border-b-2 pb-2">Resoluci√≥n de Facturaci√≥n DIAN</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">N√∫mero de Resoluci√≥n *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.resolucionFacturacion}
                                            onChange={(e) => handleConfigChange('resolucionFacturacion', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="18760000001"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Fecha de Resoluci√≥n *</label>
                                        <input
                                            type="date"
                                            value={dianConfig.fechaResolucion}
                                            onChange={(e) => handleConfigChange('fechaResolucion', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Prefijo de Factura *</label>
                                        <input
                                            type="text"
                                            value={dianConfig.prefijoFactura}
                                            onChange={(e) => handleConfigChange('prefijoFactura', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="FV"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Consecutivo Actual</label>
                                        <input
                                            type="number"
                                            value={dianConfig.consecutivoActual}
                                            onChange={(e) => handleConfigChange('consecutivoActual', parseInt(e.target.value))}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            min="1"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Rango Inicial *</label>
                                        <input
                                            type="number"
                                            value={dianConfig.rangoInicial}
                                            onChange={(e) => handleConfigChange('rangoInicial', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="1"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Rango Final *</label>
                                        <input
                                            type="number"
                                            value={dianConfig.rangoFinal}
                                            onChange={(e) => handleConfigChange('rangoFinal', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="5000"
                                        />
                                    </div>
                                </div>
                            </div>

                            {/* Facturaci√≥n Electr√≥nica */}
                            <div className="mb-8">
                                <h3 className="text-lg font-bold mb-4 text-gray-700 border-b-2 pb-2">Facturaci√≥n Electr√≥nica</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Clave T√©cnica</label>
                                        <input
                                            type="password"
                                            value={dianConfig.claveTecnica}
                                            onChange={(e) => handleConfigChange('claveTecnica', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg font-mono"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Test Set ID</label>
                                        <input
                                            type="text"
                                            value={dianConfig.testSetId}
                                            onChange={(e) => handleConfigChange('testSetId', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg font-mono"
                                            placeholder="TestSetId123"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Software ID</label>
                                        <input
                                            type="text"
                                            value={dianConfig.softwareId}
                                            onChange={(e) => handleConfigChange('softwareId', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg font-mono"
                                            placeholder="software-id-123"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Software PIN</label>
                                        <input
                                            type="password"
                                            value={dianConfig.softwarePin}
                                            onChange={(e) => handleConfigChange('softwarePin', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg font-mono"
                                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Ambiente</label>
                                        <select
                                            value={dianConfig.ambiente}
                                            onChange={(e) => handleConfigChange('ambiente', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                        >
                                            <option value="habilitacion">Habilitaci√≥n (Pruebas)</option>
                                            <option value="produccion">Producci√≥n</option>
                                        </select>
                                    </div>
                                    <div className="flex items-center p-4 border-2 rounded-lg">
                                        <input
                                            type="checkbox"
                                            checked={dianConfig.mostrarQR}
                                            onChange={(e) => handleConfigChange('mostrarQR', e.target.checked)}
                                            className="w-5 h-5 text-red-600"
                                        />
                                        <label className="ml-3 font-medium">Mostrar c√≥digo QR en factura</label>
                                    </div>
                                </div>
                            </div>

                            {/* Representante Legal y Contador */}
                            <div>
                                <h3 className="text-lg font-bold mb-4 text-gray-700 border-b-2 pb-2">Representante Legal y Contador</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Representante Legal</label>
                                        <input
                                            type="text"
                                            value={dianConfig.representanteLegal}
                                            onChange={(e) => handleConfigChange('representanteLegal', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Juan P√©rez"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Tipo Doc. Representante</label>
                                        <select
                                            value={dianConfig.tipoDocRepresentante}
                                            onChange={(e) => handleConfigChange('tipoDocRepresentante', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                        >
                                            <option value="CC">CC - C√©dula</option>
                                            <option value="CE">CE - C√©dula Extranjer√≠a</option>
                                            <option value="Pasaporte">Pasaporte</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">C√©dula Representante</label>
                                        <input
                                            type="text"
                                            value={dianConfig.cedulaRepresentante}
                                            onChange={(e) => handleConfigChange('cedulaRepresentante', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="1234567890"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Contador</label>
                                        <input
                                            type="text"
                                            value={dianConfig.contador}
                                            onChange={(e) => handleConfigChange('contador', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="Mar√≠a Gonz√°lez"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-2">Tarjeta Profesional</label>
                                        <input
                                            type="text"
                                            value={dianConfig.tarjetaContador}
                                            onChange={(e) => handleConfigChange('tarjetaContador', e.target.value)}
                                            className="w-full px-4 py-3 border-2 rounded-lg"
                                            placeholder="123456-T"
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="mt-6 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg">
                                <p className="text-sm text-blue-800">
                                    <strong>üí° Nota:</strong> Esta configuraci√≥n es fundamental para la generaci√≥n correcta de facturas electr√≥nicas seg√∫n los requisitos de la DIAN.
                                </p>
                            </div>
                        </div>
                    )}

                    {/* Configuraci√≥n de Balanza */}
                    {activeSection === 'balanza' && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icon name="Scale" className="w-7 h-7 text-red-600" />
                                Configuraci√≥n de Balanza
                            </h2>

                            <div className="space-y-6">
                                <div className="flex items-center p-4 bg-gray-50 rounded-lg border-2">
                                    <input
                                        type="checkbox"
                                        checked={balanzaConfig.habilitada}
                                        onChange={(e) => {
                                            handleBalanzaChange('habilitada', e.target.checked);
                                            if (e.target.checked) {
                                                showNotification('Balanza habilitada - Modo simulaci√≥n activo', 'success');
                                            } else {
                                                showNotification('Balanza deshabilitada', 'info');
                                            }
                                        }}
                                        className="w-6 h-6 text-red-600"
                                    />
                                    <label className="ml-3 font-bold text-lg">Habilitar Balanza Electr√≥nica</label>
                                </div>

                                {balanzaConfig.habilitada && (
                                    <>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Puerto Serial</label>
                                                <select
                                                    value={balanzaConfig.puerto}
                                                    onChange={(e) => handleBalanzaChange('puerto', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 rounded-lg"
                                                >
                                                    <option value="COM1">COM1</option>
                                                    <option value="COM2">COM2</option>
                                                    <option value="COM3">COM3</option>
                                                    <option value="COM4">COM4</option>
                                                    <option value="COM5">COM5</option>
                                                    <option value="COM6">COM6</option>
                                                    <option value="/dev/ttyUSB0">/dev/ttyUSB0 (Linux)</option>
                                                    <option value="/dev/ttyUSB1">/dev/ttyUSB1 (Linux)</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Velocidad (Baud Rate)</label>
                                                <select
                                                    value={balanzaConfig.baudRate}
                                                    onChange={(e) => handleBalanzaChange('baudRate', parseInt(e.target.value))}
                                                    className="w-full px-4 py-3 border-2 rounded-lg"
                                                >
                                                    <option value="1200">1200</option>
                                                    <option value="2400">2400</option>
                                                    <option value="4800">4800</option>
                                                    <option value="9600">9600</option>
                                                    <option value="19200">19200</option>
                                                    <option value="38400">38400</option>
                                                    <option value="57600">57600</option>
                                                    <option value="115200">115200</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Marca de Balanza</label>
                                                <select
                                                    value={balanzaConfig.marca}
                                                    onChange={(e) => handleBalanzaChange('marca', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 rounded-lg"
                                                >
                                                    <option value="TORREY">TORREY</option>
                                                    <option value="RHINO">RHINO</option>
                                                    <option value="OHAUS">OHAUS</option>
                                                    <option value="EXCELL">EXCELL</option>
                                                    <option value="METTLER">METTLER TOLEDO</option>
                                                    <option value="SARTORIUS">SARTORIUS</option>
                                                    <option value="GENERIC">Gen√©rica</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium mb-2">Modelo</label>
                                                <input
                                                    type="text"
                                                    value={balanzaConfig.modelo}
                                                    onChange={(e) => handleBalanzaChange('modelo', e.target.value)}
                                                    className="w-full px-4 py-3 border-2 rounded-lg"
                                                    placeholder="EQM-20/40"
                                                />
                                            </div>
                                        </div>

                                        <div className="p-4 bg-blue-50 border-2 border-blue-200 rounded-lg">
                                            <h4 className="font-bold mb-2 text-blue-800">‚öôÔ∏è Configuraci√≥n Adicional</h4>
                                            <div className="space-y-3">
                                                <label className="flex items-center">
                                                    <input
                                                        type="checkbox"
                                                        checked={balanzaConfig.autoCaptura}
                                                        onChange={(e) => handleBalanzaChange('autoCaptura', e.target.checked)}
                                                        className="w-5 h-5 text-blue-600"
                                                    />
                                                    <span className="ml-3 font-medium">Captura autom√°tica de peso por defecto</span>
                                                </label>
                                                <p className="text-xs text-blue-700 ml-8">
                                                    Cuando est√° activado, el peso se captura autom√°ticamente de la balanza. 
                                                    Puedes cambiar entre manual y autom√°tico en el punto de venta.
                                                </p>
                                            </div>
                                        </div>

                                        <div className="p-6 bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-300 rounded-lg">
                                            <h4 className="font-bold mb-4 flex items-center gap-2 text-green-800">
                                                <Icon name="Scale" className="w-6 h-6" />
                                                Estado de la Balanza
                                            </h4>
                                            <div className="grid grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <p className="text-sm text-green-700 mb-1">Estado:</p>
                                                    <p className="font-bold text-lg text-green-600 flex items-center gap-2">
                                                        <span className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                                                        Simulador Activo
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-green-700 mb-1">Peso Actual:</p>
                                                    <p className="font-bold text-3xl text-green-600">{currentWeight} Kg</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-green-700 mb-1">Puerto:</p>
                                                    <p className="font-semibold text-green-800">{balanzaConfig.puerto}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-green-700 mb-1">Velocidad:</p>
                                                    <p className="font-semibold text-green-800">{balanzaConfig.baudRate} bps</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-green-700 mb-1">Marca:</p>
                                                    <p className="font-semibold text-green-800">{balanzaConfig.marca}</p>
                                                </div>
                                                <div>
                                                    <p className="text-sm text-green-700 mb-1">Modelo:</p>
                                                    <p className="font-semibold text-green-800">{balanzaConfig.modelo || 'N/A'}</p>
                                                </div>
                                            </div>
                                            
                                            <div className="mt-4 p-3 bg-white rounded border border-green-200">
                                                <p className="text-xs text-gray-600">
                                                    <strong>‚ÑπÔ∏è Modo de Operaci√≥n:</strong>
                                                </p>
                                                <ul className="text-xs text-gray-600 mt-2 space-y-1 ml-4 list-disc">
                                                    <li><strong>Simulaci√≥n:</strong> El peso se genera aleatoriamente cada 2 segundos (0-5 Kg)</li>
                                                    <li><strong>Producci√≥n:</strong> Conecta tu balanza f√≠sica al puerto serial configurado</li>
                                                    <li><strong>Manual:</strong> Puedes ingresar el peso manualmente en cualquier momento</li>
                                                    <li><strong>Autom√°tico:</strong> El peso se captura directamente de la balanza</li>
                                                </ul>
                                            </div>
                                        </div>

                                        <div className="p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
                                            <h4 className="font-bold mb-2 text-yellow-800 flex items-center gap-2">
                                                <Icon name="Settings" className="w-5 h-5" />
                                                Instrucciones de Conexi√≥n
                                            </h4>
                                            <ol className="text-sm text-yellow-800 space-y-2 ml-4 list-decimal">
                                                <li>Conecta tu balanza al puerto serial de la computadora</li>
                                                <li>Selecciona el puerto correcto (generalmente COM1 en Windows)</li>
                                                <li>Configura la velocidad seg√∫n el manual de tu balanza (com√∫n: 9600 bps)</li>
                                                <li>Marca y modelo son para referencia</li>
                                                <li>En el punto de venta, puedes cambiar entre modo manual y autom√°tico</li>
                                            </ol>
                                            <p className="text-xs text-yellow-700 mt-3">
                                                <strong>Nota:</strong> Para usar una balanza real en un navegador web, necesitar√°s un middleware 
                                                o extensi√≥n que permita la comunicaci√≥n serial. El sistema actualmente funciona en modo simulaci√≥n 
                                                para pruebas.
                                            </p>
                                        </div>
                                    </>
                                )}

                                {!balanzaConfig.habilitada && (
                                    <div className="p-6 bg-gray-50 border-2 border-gray-200 rounded-lg text-center">
                                        <Icon name="Scale" className="w-16 h-16 mx-auto mb-4 text-gray-400" />
                                        <p className="text-gray-600 font-semibold">Balanza deshabilitada</p>
                                        <p className="text-sm text-gray-500 mt-2">
                                            Activa la balanza para capturar pesos autom√°ticamente en el punto de venta
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* Respaldo y Recuperaci√≥n */}
                    {activeSection === 'backup' && (
                        <div className="bg-white rounded-xl shadow-lg p-6">
                            <h2 className="text-2xl font-bold mb-6 flex items-center gap-2">
                                <Icon name="Download" className="w-7 h-7 text-red-600" />
                                Respaldo y Recuperaci√≥n
                            </h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div className="p-6 bg-blue-50 rounded-lg border-2 border-blue-200">
                                    <Icon name="Package" className="w-10 h-10 text-blue-600 mb-3" />
                                    <p className="text-sm text-blue-700 mb-2">Productos</p>
                                    <p className="text-3xl font-bold text-blue-600">{productos.length}</p>
                                </div>
                                <div className="p-6 bg-green-50 rounded-lg border-2 border-green-200">
                                    <Icon name="Receipt" className="w-10 h-10 text-green-600 mb-3" />
                                    <p className="text-sm text-green-700 mb-2">Ventas</p>
                                    <p className="text-3xl font-bold text-green-600">{ventas.length}</p>
                                </div>
                                <div className="p-6 bg-purple-50 rounded-lg border-2 border-purple-200">
                                    <Icon name="Users" className="w-10 h-10 text-purple-600 mb-3" />
                                    <p className="text-sm text-purple-700 mb-2">Clientes</p>
                                    <p className="text-3xl font-bold text-purple-600">{clientes.length}</p>
                                </div>
                            </div>

                            <div className="space-y-3">
                                <button
                                    onClick={handleExportar}
                                    className="w-full bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 font-bold text-lg flex items-center justify-center gap-3 shadow-lg"
                                >
                                    <Icon name="Download" className="w-6 h-6" />
                                    Exportar Todos los Datos (JSON)
                                </button>
                                
                                <label className="w-full bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 font-bold text-lg flex items-center justify-center gap-3 shadow-lg cursor-pointer">
                                    <Icon name="Upload" className="w-6 h-6" />
                                    Importar Datos desde Archivo
                                    <input
                                        type="file"
                                        accept=".json"
                                        onChange={handleImportar}
                                        className="hidden"
                                    />
                                </label>
                            </div>

                            <div className="mt-6 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg">
                                <p className="text-sm text-yellow-800">
                                    <strong>üíæ Respaldo Autom√°tico:</strong> Los datos se guardan autom√°ticamente en tu navegador. Exporta peri√≥dicamente para mayor seguridad.
                                </p>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // ==================== MODAL DE FACTURA ====================
        function InvoiceModal({ saleForInvoice, clientes, dianConfig, setShowInvoiceModal, setCart }) {
            const [selectedCliente, setSelectedCliente] = useState(clientes[0]);

            const generateInvoice = () => {
                const subtotal = saleForInvoice.total / 1.19;
                const iva = saleForInvoice.total - subtotal;

                const w = window.open('', '_blank');
                w.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Factura ${saleForInvoice.numeroFactura}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .header { text-align: center; border-bottom: 3px solid #c00; padding-bottom: 20px; margin-bottom: 20px; }
                            .company-info { margin-bottom: 20px; }
                            .invoice-info { background: #f5f5f5; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
                            th { background: #c00; color: white; font-weight: bold; }
                            .totals { text-align: right; margin: 20px 0; }
                            .totals p { margin: 5px 0; }
                            .total-final { font-size: 24px; font-weight: bold; color: #c00; margin-top: 10px; }
                            .footer { text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #ccc; font-size: 12px; color: #666; }
                            @media print {
                                button { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1 style="color: #c00; margin: 0;">FACTURA ELECTR√ìNICA DE VENTA</h1>
                            <h2 style="margin: 10px 0;">${saleForInvoice.numeroFactura}</h2>
                            <p style="margin: 5px 0;">CUFE: ${Date.now().toString(36).toUpperCase()}</p>
                        </div>
                        
                        <div class="company-info">
                            <h3>${dianConfig.razonSocial || dianConfig.nombreComercial || 'Carnicer√≠a'}</h3>
                            <p><strong>NIT:</strong> ${dianConfig.nit || 'N/A'}</p>
                            <p><strong>Direcci√≥n:</strong> ${dianConfig.direccion || 'N/A'}, ${dianConfig.ciudad || ''}, ${dianConfig.departamento || ''}</p>
                            <p><strong>Tel√©fono:</strong> ${dianConfig.telefono || 'N/A'} | <strong>Email:</strong> ${dianConfig.email || 'N/A'}</p>
                            <p><strong>R√©gimen:</strong> ${dianConfig.regimenFiscal} | <strong>Responsabilidad:</strong> ${dianConfig.responsabilidadFiscal}</p>
                            ${dianConfig.resolucionFacturacion ? `<p><strong>Resoluci√≥n DIAN:</strong> ${dianConfig.resolucionFacturacion} del ${new Date(dianConfig.fechaResolucion).toLocaleDateString('es-CO')}</p>` : ''}
                            ${dianConfig.rangoInicial && dianConfig.rangoFinal ? `<p><strong>Rango autorizado:</strong> ${dianConfig.prefijoFactura}${dianConfig.rangoInicial} - ${dianConfig.prefijoFactura}${dianConfig.rangoFinal}</p>` : ''}
                        </div>
                        
                        <div class="invoice-info">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <strong>CLIENTE:</strong><br>
                                    ${selectedCliente.nombre}<br>
                                    ${selectedCliente.tipoDoc}: ${selectedCliente.numeroDoc}<br>
                                    ${selectedCliente.telefono ? 'Tel: ' + selectedCliente.telefono : ''}<br>
                                    ${selectedCliente.direccion || ''}
                                </div>
                                <div style="text-align: right;">
                                    <strong>Fecha:</strong> ${new Date().toLocaleDateString('es-CO')}<br>
                                    <strong>Hora:</strong> ${new Date().toLocaleTimeString('es-CO')}<br>
                                    <strong>Tipo de Pago:</strong> ${saleForInvoice.tipoPago}<br>
                                    <strong>Vendedor:</strong> ${saleForInvoice.vendedor}
                                </div>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Cantidad (Kg)</th>
                                    <th>Precio/Kg</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${saleForInvoice.items.map(item => 
                                    `<tr>
                                        <td>${item.name}</td>
                                        <td>${item.weight}</td>
                                        <td>$${item.pricePerKg.toLocaleString('es-CO')}</td>
                                        <td>$${item.subtotal.toLocaleString('es-CO')}</td>
                                    </tr>`
                                ).join('')}
                            </tbody>
                        </table>
                        
                        <div class="totals">
                            <p><strong>Subtotal:</strong> $${subtotal.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                            <p><strong>IVA (19%):</strong> $${iva.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</p>
                            <p class="total-final">TOTAL: $${saleForInvoice.total.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})} COP</p>
                        </div>
                        
                        ${dianConfig.mostrarQR ? '<div style="text-align: center; margin: 20px 0;"><p><strong>C√≥digo QR</strong></p><div style="width: 150px; height: 150px; border: 2px solid #000; margin: 10px auto; display: flex; align-items: center; justify-content: center;">QR Aqu√≠</div></div>' : ''}
                        
                        <div class="footer">
                            <p><strong>¬°Gracias por su compra!</strong></p>
                            <p>Factura Electr√≥nica de Venta - DIAN Colombia</p>
                            <p>Ambiente: ${dianConfig.ambiente === 'produccion' ? 'Producci√≥n' : 'Habilitaci√≥n (Pruebas)'}</p>
                            ${dianConfig.representanteLegal ? `<p>Representante Legal: ${dianConfig.representanteLegal} - ${dianConfig.tipoDocRepresentante} ${dianConfig.cedulaRepresentante}</p>` : ''}
                            ${dianConfig.contador ? `<p>Contador: ${dianConfig.contador} - TP ${dianConfig.tarjetaContador}</p>` : ''}
                            <p style="margin-top: 10px; font-size: 10px;">Este documento es una representaci√≥n impresa de la factura electr√≥nica generada y validada ante la DIAN</p>
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <button onclick="window.print()" style="background: #c00; color: white; border: none; padding: 10px 30px; border-radius: 5px; cursor: pointer; font-size: 16px;">
                                Imprimir Factura
                            </button>
                        </div>
                    </body>
                    </html>
                `);
                w.document.close();
                setTimeout(() => w.print(), 500);

                setShowInvoiceModal(false);
                setCart([]);
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold flex items-center gap-2">
                                <Icon name="Receipt" className="w-7 h-7 text-red-600" />
                                Generar Factura
                            </h2>
                            <button 
                                onClick={() => { setShowInvoiceModal(false); setCart([]); }} 
                                className="text-gray-500 hover:text-gray-700 hover:bg-gray-100 p-2 rounded-full"
                            >
                                <Icon name="X" />
                            </button>
                        </div>

                        <div className="mb-6">
                            <label className="block text-sm font-medium mb-2">Cliente</label>
                            <select 
                                value={selectedCliente?.id || ''} 
                                onChange={(e) => setSelectedCliente(clientes.find(c => c.id === e.target.value))} 
                                className="w-full px-4 py-3 border-2 rounded-lg focus:ring-2 focus:ring-red-500"
                            >
                                {clientes.map(c => (
                                    <option key={c.id} value={c.id}>
                                        {c.nombre} - {c.tipoDoc} {c.numeroDoc}
                                    </option>
                                ))}
                            </select>
                        </div>

                        <div className="mb-6 p-5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-lg border-2 border-gray-200">
                            <h3 className="font-bold mb-3 text-lg">Resumen de Venta</h3>
                            <div className="space-y-2">
                                <div className="flex justify-between">
                                    <span>Tipo de Pago:</span>
                                    <span className="font-bold">{saleForInvoice.tipoPago}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Subtotal:</span>
                                    <span className="font-bold">${(saleForInvoice.total / 1.19).toLocaleString('es-CO', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>IVA (19%):</span>
                                    <span className="font-bold">${(saleForInvoice.total - saleForInvoice.total / 1.19).toLocaleString('es-CO', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div className="flex justify-between pt-2 border-t-2 border-gray-300">
                                    <span className="text-lg font-bold">TOTAL:</span>
                                    <span className="text-2xl font-bold text-red-600">${saleForInvoice.total.toLocaleString('es-CO', {minimumFractionDigits: 2})}</span>
                                </div>
                                <div className="flex justify-between p-3 bg-green-50 rounded-lg border-2 border-green-200 mt-2">
                                    <span className="font-bold text-green-700">Utilidad:</span>
                                    <span className="text-xl font-bold text-green-600">+${saleForInvoice.utilidadTotal.toLocaleString('es-CO')}</span>
                                </div>
                            </div>
                        </div>

                        <div className="flex gap-3">
                            <button 
                                onClick={() => { setShowInvoiceModal(false); setCart([]); }} 
                                className="flex-1 bg-gray-500 text-white py-3 rounded-lg hover:bg-gray-600 font-semibold"
                            >
                                Venta Sin Factura
                            </button>
                            <button 
                                onClick={generateInvoice} 
                                className="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 font-semibold flex items-center justify-center gap-2"
                            >
                                <Icon name="Receipt" className="w-5 h-5" />
                                Generar e Imprimir
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // ==================== RENDERIZAR ====================
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
